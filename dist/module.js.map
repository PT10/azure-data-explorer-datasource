{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"react\"","webpack:///external \"@grafana/ui\"","webpack:///external \"emotion\"","webpack:///external \"lodash\"","webpack:///external \"@grafana/data\"","webpack:///external \"app/core/config\"","webpack:///external \"@grafana/runtime\"","webpack:///../node_modules/react-use/node_modules/tslib/tslib.es6.js","webpack:///../node_modules/debounce-promise/dist/index.js","webpack:///external \"angular\"","webpack:///../node_modules/tslib/tslib.es6.js","webpack:///./editor/expressions.ts","webpack:///./response_parser.ts","webpack:///./types.ts","webpack:///./common/annotationsFromFrame.ts","webpack:///./query_builder.ts","webpack:///./schema/cache.ts","webpack:///./datasource.ts","webpack:///./common/responseHelpers.ts","webpack:///../node_modules/react-use/esm/useAsyncFn.js","webpack:///../node_modules/react-use/esm/useMountedState.js","webpack:///../node_modules/react-use/esm/useAsync.js","webpack:///./editor/types.ts","webpack:///./monaco/kusto_code_editor.ts","webpack:///./monaco/KustoMonacoEditor.tsx","webpack:///./components/QueryEditorResultFormat.tsx","webpack:///./components/RawQueryEditor.tsx","webpack:///./schema/mapper.ts","webpack:///./editor/components/QueryEditorSection.tsx","webpack:///./editor/components/field/QueryEditorField.tsx","webpack:///./editor/guards.ts","webpack:///./editor/builders/QueryEditorFieldBuilder.ts","webpack:///./editor/components/field/QueryEditorFieldSection.tsx","webpack:///./editor/components/operators/QueryEditorMultiOperator.tsx","webpack:///./editor/components/operators/QueryEditorSingleOperator.tsx","webpack:///./editor/components/operators/QueryEditorBoolOperator.tsx","webpack:///./editor/components/operators/parser.ts","webpack:///./editor/components/operators/QueryEditorOperator.tsx","webpack:///./editor/components/filter/QueryEditorFieldAndOperator.tsx","webpack:///./editor/components/QueryEditorRepeater.tsx","webpack:///./editor/components/filter/QueryEditorFilterSection.tsx","webpack:///./editor/builders/QueryEditorOperatorBuilder.ts","webpack:///./editor/builders/QueryEditorFilterBuilder.ts","webpack:///./editor/components/field/QueryEditorFunctionParameterSection.tsx","webpack:///./editor/components/reduce/QueryEditorReduce.tsx","webpack:///./editor/components/reduce/QueryEditorReduceSection.tsx","webpack:///./editor/builders/QueryEditorFunctionBuilder.tsx","webpack:///./editor/builders/QueryEditorReduceBuilder.ts","webpack:///./editor/components/groupBy/QueryEditorGroupBy.tsx","webpack:///./editor/components/groupBy/QueryEditorGroupBySection.tsx","webpack:///./editor/builders/QueryEditorIntervalBuilder.ts","webpack:///./editor/builders/QueryEditorGroupByBuilder.ts","webpack:///./components/VisualQueryEditorSections.tsx","webpack:///./editor/index.ts","webpack:///./schema/AdxSchemaResolver.ts","webpack:///./KustoExpressionParser.ts","webpack:///./schema/AdxAutoComplete.ts","webpack:///./components/SchemaMessages.tsx","webpack:///./components/VisualQueryEditor.tsx","webpack:///./components/QueryEditorToolbar.tsx","webpack:///./migrations/expression.ts","webpack:///./migrations/query.ts","webpack:///./QueryEditor.tsx","webpack:///./version.ts","webpack:///./config_ctrl.ts","webpack:///./monaco/kusto_monaco_editor.ts","webpack:///./annotations_query_ctrl.ts","webpack:///./module.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","__WEBPACK_EXTERNAL_MODULE__0__","__WEBPACK_EXTERNAL_MODULE__1__","__WEBPACK_EXTERNAL_MODULE__2__","__WEBPACK_EXTERNAL_MODULE__3__","__WEBPACK_EXTERNAL_MODULE__4__","__WEBPACK_EXTERNAL_MODULE__5__","__WEBPACK_EXTERNAL_MODULE__6__","__assign","assign","arguments","length","apply","this","getWait","wait","defer","deferred","promise","Promise","resolve","reject","fn","undefined","options","lastCallAt","timer","pendingArgs","currentWait","currentTime","Date","getTime","isCold","_len","args","Array","_key","leading","accumulate","then","result","concat","clearTimeout","push","setTimeout","flush","argsIndex","results","thisDeferred","__WEBPACK_EXTERNAL_MODULE__9__","extendStatics","b","setPrototypeOf","__proto__","__extends","__","constructor","__rest","e","indexOf","getOwnPropertySymbols","propertyIsEnumerable","__awaiter","thisArg","_arguments","P","generator","fulfilled","step","next","rejected","done","__generator","body","f","y","g","_","label","sent","trys","ops","verb","iterator","v","op","TypeError","pop","__values","__read","ar","error","__spread","__makeTemplateObject","cooked","raw","QueryEditorExpressionType","parseDatabases","databases","data","Tables","table","Rows","row","text","parseSchemaResult","schemaJson","JSON","parse","packageJson","defaultQuery","query","querySource","expression","where","type","And","expressions","groupBy","reduce","pluginVersion","version","defaultAnnotationEventFinder","userId","login","email","avatarUrl","time","timeEnd","title","tags","interpolateKustoQuery","scopedVars","replace","match","p1","p2","inputs","firstCommaIndex","field","substring","templateVar","toLowerCase","trim","singleQuote","getMultiContains","values","split","map","join","input","store","resolver","instanceSettings","backendSrv","templateSrv","baseUrl","defaultOrFirstDatabase","jsonData","defaultDatabase","url","filterQuery","target","hide","rawMode","tableExpr","from","applyTemplateVariables","q","interpolateVariable","database","annotationQuery","annotation","resultFormat","targets","range","maxDataPoints","interval","intervalMs","toPromise","res","state","Done","frame","events","hasTime","hasText","byName","fields","finder","entries","lower","regex","RegExp","find","anno","exec","getAnnotationsFromFrame","Error","console","log","message","metricFindQuery","optionalOptions","getDatabases","getDefaultOrFirstDatabase","buildQuery","response","firstStringFieldToMetricFindValue","err","req","csl","doRequest","getSchema","id","getDynamicSchema","columns","isArray","queryParts","column","project","summarize","getVariables","interpolatedQuery","refId","maxRetries","datasourceRequest","method","variable","multi","includeAll","val","filter","frames","json","columnSchemas","columnName","recordSchema","schema","keys","Name","CslType","useAsyncFn","deps","initialState","loading","mountedRef","lastCallId","isMounted","current","_a","set","_i","callId","prevState","useAsync","callback","QueryEditorPropertyType","containerDiv","defaultTimeField","config","splitWithNewLineRegex","newLineRegex","startsWithKustoPipeRegex","kustoPipeRegexStrict","initMonaco","content","themeName","bootData","user","lightTheme","monaco","editor","defineTheme","base","inherit","rules","token","foreground","background","colors","languages","kustoDefaults","setLanguageSettings","includeControlCommands","newlineAfterPipe","useIntellisenseV2","codeEditor","language","selectionHighlight","theme","folding","lineNumbers","lineHeight","suggestFontSize","dragAndDrop","occurrencesHighlight","minimap","enabled","renderIndentGuides","wordWrap","layout","getModels","completionItemProvider","registerCompletionItemProvider","triggerCharacters","provideCompletionItems","getCompletionItems","signatureHelpProvider","registerSignatureHelpProvider","signatureHelpTriggerCharacters","provideSignatureHelp","getSignatureHelp","createContextKey","onDidChangeCursorSelection","event","getKustoWorker","workerAccessor","model","getModel","uri","worker","dbName","Databases","setSchemaFromShowSchema","resize","setOnDidChangeModelContent","listener","onDidChangeModelContent","disposeMonaco","dispose","addCommand","keybinding","commandFunc","getValue","toSuggestionController","srv","setEditorContent","setValue","position","timeFilterDocs","textUntilPosition","getValueInRange","startLineNumber","startColumn","endLineNumber","lineNumber","endColumn","includes","getLineContent","kind","CompletionItemKind","Keyword","insertText","documentation","activeParameter","activeSignature","signatures","parameters","source","reason","CursorChangeReason","RecoverFromMarkers","getCharAt","selection","positionLineNumber","positionColumn","triggerSuggestions","suggestController","getContribution","convertedController","_model","cancel","trigger","getLineCount","line","props","getStyles","styles","monacoRef","createRef","window","System","pluginBaseUrl","kustoCodeEditor","KeyMod","Shift","KeyCode","Enter","newValue","onChange","onExecute","onresize","componentWillUnmount","render","tabIndex","className","ref","Component","formats","adxTimeFormat","onChangeFormat","selectable","format","container","width","includeAdxTimeFormat","selectResultFormat","includeAdxFormat","selected","onRawQueryChange","kql","onChangeResultFormat","datasource","lastQueryError","lastQuery","timeNotASC","showLastQuery","showHelp","meta","onRunQuery","toolbar","onClick","setState","String","columnsToDefinition","kustoType","Number","DateTime","Boolean","children","definitionToProperty","definition","templateVariableOptions","placeholder","menuPlacement","allowCustomValue","allowCustom","option","Reduce","Property","Operator","GroupBy","isMultiOperator","operator","isSingleOperator","Or","build","defaultValue","buildFieldExpression","onCreate","getSuggestions","txt","defaultOptions","loadOptions","onCreateOption","noOptionsMessage","isClearable","evt","backspaceRemovesValue","multipleValues","casted","isUndefined","all","isNumber","toNumber","comparable","toLower","startsWith","definitionToOperator","booleanValues","onChangeOperator","operators","currentValue","onChangeValue","isSearchable","renderControl","forwardRef","otherProps","variant","isBoolOperator","componentDidMount","updateOperators","supportTypes","onFieldChanged","currentOperator","onOperatorChange","variables","showOperators","index","splice","Fragment","onAdd","onRemove","rowWithSpacing","spacing","types","description","multiple","bool","withLabel","withDescription","add","withOperators","QueyEditorOperatorBuilder","withMultipleRows","buildOperatorExpression","icon","filterProps","operatorProps","isFirst","rowStyles","currentTarget","onBlur","FunctionParameter","fieldType","setField","setReduce","setParameters","onChangeField","reducer","functions","Function","onChangeReduce","onChangeParameter","payload","reduceParameters","getParameters","param","func","withParameter","withFunctions","buildReduceExpression","childProps","rowStyle","buildProperty","setInterval","Interval","intervals","onChangeInterval","withIntervals","buildGroupByExpressions","KustoFromEditorSection","fieldSection","builder","KustoWhereEditorSection","filterSection","KustoValueColumnEditorSection","reduceSection","KustoGroupByEditorSection","groupBySection","createCacheKey","addition","schemaKey","cacheKey","getTablesForDatabase","databaseName","db","getColumnsForTable","tableName","tables","dynamicColumns","OrderedColumns","schemaByColumn","schemaForDynamicColumn","limit","fromTable","interpolate","sections","definitionColumns","defaultTimeColumn","col","parts","isAggregated","appendTimeFilter","appendWhere","appendSummarize","appendProject","groupByExpression","dateTimeField","getGroupByFields","timeCol","exp","toProject","castIfDynamic","orderBy","createWhere","processMultiValueFilter","isQuotedString","isVariable","and","orParts","orExpression","part","statement","reduceExpression","reduceExpressions","groupByFields","columnSchema","columnType","search","searchTerm","toArray","warning","formInputBorderInvalid","palette","yellow","kustoExpressionParser","tableSchema","getTableSchema","onAutoComplete","groupable","onChangeTable","onChangeQuery","onWhereChange","onReduceChange","onGroupByChange","cols","rows","disabled","databaseSchema","showConfirm","setShowConfirm","onToggleMode","dirty","editorMode","onToggleEditorMode","onChangeDatabase","isOpen","confirmText","dismissText","onConfirm","onDismiss","looksLikeV2","migrated","migrateV2Expression","migrateV2Property","isRawMode","series","executedQueryString","executedQuery","kustoError","custom","KustoError","expanded","versionPattern","major","minor","patch","isGtOrEq","compared","SemVersion","isValid","$scope","hasRequiredGrafanaVersion","hasMinVersion","suggestUrl","getSuggestUrls","dbs","$digest","a","buildInfo","latestVersion","showMinVersionWarning","templateUrl","scope","elem","attrs","$watch","oldValue","editorValue","$$postDigest","$apply","$on","onblur","onkeydown","stopPropagation","directive","restrict","template","link","list","setConfigCtrl","setAnnotationQueryCtrl","KustoDBAnnotationsQueryCtrl","setQueryEditor","executedQueryError","templateVariables"],"mappings":"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","file":"module.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 12);\n","module.exports = __WEBPACK_EXTERNAL_MODULE__0__;","module.exports = __WEBPACK_EXTERNAL_MODULE__1__;","module.exports = __WEBPACK_EXTERNAL_MODULE__2__;","module.exports = __WEBPACK_EXTERNAL_MODULE__3__;","module.exports = __WEBPACK_EXTERNAL_MODULE__4__;","module.exports = __WEBPACK_EXTERNAL_MODULE__5__;","module.exports = __WEBPACK_EXTERNAL_MODULE__6__;","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","'use strict';\n\n/* global setTimeout, clearTimeout */\n\nmodule.exports = function debounce(fn) {\n  var wait = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n  var lastCallAt = void 0;\n  var deferred = void 0;\n  var timer = void 0;\n  var pendingArgs = [];\n  return function debounced() {\n    var currentWait = getWait(wait);\n    var currentTime = new Date().getTime();\n\n    var isCold = !lastCallAt || currentTime - lastCallAt > currentWait;\n\n    lastCallAt = currentTime;\n\n    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    if (isCold && options.leading) {\n      return options.accumulate ? Promise.resolve(fn.call(this, [args])).then(function (result) {\n        return result[0];\n      }) : Promise.resolve(fn.call.apply(fn, [this].concat(args)));\n    }\n\n    if (deferred) {\n      clearTimeout(timer);\n    } else {\n      deferred = defer();\n    }\n\n    pendingArgs.push(args);\n    timer = setTimeout(flush.bind(this), currentWait);\n\n    if (options.accumulate) {\n      var argsIndex = pendingArgs.length - 1;\n      return deferred.promise.then(function (results) {\n        return results[argsIndex];\n      });\n    }\n\n    return deferred.promise;\n  };\n\n  function flush() {\n    var thisDeferred = deferred;\n    clearTimeout(timer);\n\n    Promise.resolve(options.accumulate ? fn.call(this, pendingArgs) : fn.apply(this, pendingArgs[pendingArgs.length - 1])).then(thisDeferred.resolve, thisDeferred.reject);\n\n    pendingArgs = [];\n    deferred = null;\n  }\n};\n\nfunction getWait(wait) {\n  return typeof wait === 'function' ? wait() : wait;\n}\n\nfunction defer() {\n  var deferred = {};\n  deferred.promise = new Promise(function (resolve, reject) {\n    deferred.resolve = resolve;\n    deferred.reject = reject;\n  });\n  return deferred;\n}\n//# sourceMappingURL=index.js.map","module.exports = __WEBPACK_EXTERNAL_MODULE__9__;","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __createBinding(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","import { QueryEditorPropertyType, QueryEditorProperty, QueryEditorOperator } from './types';\n\nexport enum QueryEditorExpressionType {\n  Property = 'property',\n  Operator = 'operator',\n  Reduce = 'reduce',\n  FunctionParameter = 'functionParameter',\n  GroupBy = 'groupBy',\n  Or = 'or',\n  And = 'and',\n}\nexport interface QueryEditorExpression {\n  type: QueryEditorExpressionType;\n}\n\nexport interface QueryEditorPropertyExpression extends QueryEditorExpression {\n  property: QueryEditorProperty;\n}\nexport interface QueryEditorOperatorExpression extends QueryEditorExpression {\n  property: QueryEditorProperty;\n  operator: QueryEditorOperator;\n}\n\nexport interface QueryEditorFunctionParameterExpression extends QueryEditorExpression {\n  value: string;\n  fieldType: QueryEditorPropertyType;\n  name: string;\n}\n\nexport interface QueryEditorReduceExpression extends QueryEditorExpression {\n  property: QueryEditorProperty;\n  reduce: QueryEditorProperty;\n  parameters?: QueryEditorFunctionParameterExpression[];\n}\n\nexport interface QueryEditorGroupByExpression extends QueryEditorExpression {\n  property: QueryEditorProperty;\n  interval?: QueryEditorProperty;\n}\nexport interface QueryEditorArrayExpression extends QueryEditorExpression {\n  expressions: QueryEditorExpression[];\n}\n","import _ from 'lodash';\n\nexport interface DataTarget {\n  target: string;\n  datapoints: any[];\n  refId: string;\n  query: any;\n}\n\nexport interface TableResult {\n  columns: TableColumn[];\n  rows: any[];\n  type: string;\n  refId: string;\n  query: string;\n}\n\nexport interface TableColumn {\n  text: string;\n  type: string;\n}\n\nexport interface Variable {\n  text: string;\n  value: string;\n}\n\n// API interfaces\nexport interface KustoDatabaseList {\n  data: {\n    Tables: KustoDatabaseItem[];\n  };\n}\n\nexport interface KustoDatabaseItem {\n  TableName: string;\n  Columns: any[];\n  Rows: any[];\n}\n\nexport interface KustoSchema {\n  Databases: { [key: string]: KustoDatabase };\n  Plugins: any[];\n}\nexport interface KustoDatabase {\n  Name: string;\n  Tables: { [key: string]: KustoTable };\n  Functions: { [key: string]: KustoFunction };\n}\n\nexport interface KustoTable {\n  Name: string;\n  OrderedColumns: KustoColumn[];\n}\n\nexport interface KustoColumn {\n  Name: string;\n  Type: string;\n}\n\nexport interface KustoFunction {\n  Name: string;\n  DocString: string;\n  Body: string;\n  Folder: string;\n  FunctionKind: string;\n  InputParameters: any[];\n  OutputColumns: any[];\n}\n\n// Internal interfaces\nexport interface DatabaseItem {\n  text: string;\n  value: string;\n}\n\nexport class ResponseParser {\n  parseDatabases(results: KustoDatabaseList): DatabaseItem[] {\n    const databases: DatabaseItem[] = [];\n    if (!results || !results.data || !results.data.Tables || results.data.Tables.length === 0) {\n      return databases;\n    }\n\n    for (const table of results.data.Tables) {\n      for (const row of table.Rows) {\n        databases.push({ text: row[5] || row[0], value: row[0] });\n      }\n    }\n\n    return databases;\n  }\n\n  parseSchemaResult(results: any): KustoSchema {\n    const schemaJson = results.Tables[0].Rows[0][0];\n    return JSON.parse(schemaJson);\n  }\n}\n","const packageJson = require('../package.json');\n\nimport { DataQuery, DataSourceJsonData } from '@grafana/data';\nimport {\n  QueryEditorPropertyExpression,\n  QueryEditorArrayExpression,\n  QueryEditorExpressionType,\n} from './editor/expressions';\n\nexport interface QueryExpression {\n  from?: QueryEditorPropertyExpression;\n  where: QueryEditorArrayExpression;\n  reduce: QueryEditorArrayExpression;\n  groupBy: QueryEditorArrayExpression;\n}\n\ntype QuerySource = 'raw' | 'schema' | 'autocomplete' | 'visual';\nexport interface KustoQuery extends DataQuery {\n  query: string;\n  database: string;\n  alias?: string;\n  resultFormat: string;\n  expression: QueryExpression;\n  rawMode?: boolean;\n  querySource: QuerySource;\n  pluginVersion: string;\n}\n\nexport const defaultQuery: Pick<KustoQuery, 'query' | 'expression' | 'querySource' | 'pluginVersion'> = {\n  query: '',\n  querySource: 'raw',\n  expression: {\n    where: {\n      type: QueryEditorExpressionType.And,\n      expressions: [],\n    },\n    groupBy: {\n      type: QueryEditorExpressionType.And,\n      expressions: [],\n    },\n    reduce: {\n      type: QueryEditorExpressionType.And,\n      expressions: [],\n    },\n  },\n  pluginVersion: packageJson.version,\n};\n\nexport interface AdxDataSourceOptions extends DataSourceJsonData {\n  defaultDatabase: string;\n  minimalCache: number;\n}\n\nexport interface AdxSchema {\n  Databases: Record<string, AdxDatabaseSchema>;\n}\n\nexport interface AdxDatabaseSchema {\n  Name: string;\n  Tables: Record<string, AdxTableSchema>;\n  ExternalTables: Record<string, AdxTableSchema>;\n}\n\nexport interface AdxTableSchema {\n  Name: string;\n  OrderedColumns: AdxColumnSchema[];\n}\n\nexport interface AdxColumnSchema {\n  Name: string;\n  CslType: string;\n}\n","import { AnnotationEvent, DataFrame, FieldType, Field, KeyValue } from '@grafana/data';\n\ninterface AnnotationEventNames {\n  userId?: string;\n  login?: string;\n  email?: string;\n  avatarUrl?: string;\n  time?: string; // or first time\n  timeEnd?: string;\n  title?: string;\n  text?: string; // or first string\n  tags?: string; // Split on ','\n}\n\nconst defaultAnnotationEventFinder: AnnotationEventNames = {\n  userId: 'userId',\n  login: 'login',\n  email: 'email',\n  avatarUrl: 'avatarUrl',\n  time: 'time',\n  timeEnd: 'timeEnd',\n  title: 'title',\n  text: 'text',\n  tags: 'tags',\n};\n\ninterface AnnotationEventFieldSetter {\n  key: string;\n  field: Field;\n\n  regex?: RegExp; // for text\n  split?: string; // for tags\n}\n\nexport interface AnnotationsFromFrameOptions {\n  field?: AnnotationEventNames;\n  regex?: AnnotationEventNames;\n}\n\nexport function getAnnotationsFromFrame(frame: DataFrame, options?: AnnotationsFromFrameOptions): AnnotationEvent[] {\n  const events: AnnotationEvent[] = [];\n  if (!frame || !frame.length) {\n    return events;\n  }\n\n  let hasTime = false;\n  let hasText = false;\n  const byName: KeyValue<Field> = {};\n  for (const f of frame.fields) {\n    byName[f.name.toLowerCase()] = f;\n  }\n\n  const fields: AnnotationEventFieldSetter[] = [];\n  const finder: AnnotationEventNames = {\n    ...defaultAnnotationEventFinder,\n    ...options?.field,\n  };\n  for (const [key, value] of Object.entries(finder)) {\n    const lower = value ? value.toLowerCase() : '';\n    if (lower && byName[lower]) {\n      const v: AnnotationEventFieldSetter = {\n        key,\n        field: byName[lower],\n      };\n      switch (key) {\n        case 'time':\n          hasTime = true;\n          break;\n        case 'text':\n          hasText = true;\n          break;\n        case 'tags':\n          v.split = ',';\n          break;\n      }\n      if (options?.regex && options.regex[key]) {\n        v.regex = new RegExp(options.regex[key]);\n      }\n      fields.push(v);\n    }\n  }\n  if (!hasTime) {\n    const field = frame.fields.find(f => f.type === FieldType.time);\n    if (!field) {\n      return [];\n    }\n    fields.push({\n      key: 'time',\n      field,\n    });\n  }\n\n  if (!hasText) {\n    const field = frame.fields.find(f => f.type === FieldType.string);\n    if (!field) {\n      return [];\n    }\n    if (options?.regex?.text) {\n      fields.push({\n        key: 'time',\n        field,\n        regex: new RegExp(options.regex.text),\n      });\n    } else {\n      fields.push({\n        key: 'time',\n        field,\n      });\n    }\n  }\n\n  // Add each value to the string\n  for (let i = 0; i < frame.length; i++) {\n    const anno: AnnotationEvent = {};\n    for (const f of fields) {\n      let v = f.field.values.get(i);\n      if (f.regex) {\n        const match = f.regex.exec(v);\n        if (match) {\n          v = match[1] ? match[1] : match[0];\n        }\n      }\n      if (f.split) {\n        v = (v as string).split(',');\n      }\n      anno[f.key] = v;\n    }\n    events.push(anno);\n  }\n\n  return events;\n}\n","import { ScopedVars } from '@grafana/data';\n\nexport default function interpolateKustoQuery(query: string, scopedVars?: ScopedVars): string {\n  if (!query) {\n    return '';\n  }\n  const macroRegexp = /\\$__([_a-zA-Z0-9]+)\\(([^\\)]*)\\)/gi;\n  const intervalRegexp = /\\$(__interval|__interval_ms)/gi;\n\n  query = query.replace(macroRegexp, (match, p1, p2) => {\n    if (p1 === 'contains') {\n      return getMultiContains(p2);\n    }\n    return match;\n  });\n\n  query = query.replace(intervalRegexp, (match, p1) => {\n    if (!scopedVars) {\n      return match;\n    }\n    const values = scopedVars[p1];\n    return values?.value ?? match;\n  });\n\n  return query.replace(/\\$__escapeMulti\\(('[^]*')\\)/gi, (match, p1) => escape(p1));\n}\n\nfunction getMultiContains(inputs: string) {\n  const firstCommaIndex = inputs.indexOf(',');\n  const field = inputs.substring(0, firstCommaIndex);\n  const templateVar = inputs.substring(inputs.indexOf(',') + 1);\n\n  if (templateVar && templateVar.toLowerCase().trim() === 'all') {\n    return '1 == 1';\n  }\n\n  return `${field.trim()} in (${singleQuote(templateVar.trim())})`;\n}\n\nfunction escape(inputs: string) {\n  return inputs\n    .substring(1, inputs.length - 1)\n    .split(`','`)\n    .map(v => `@'${v}'`)\n    .join(', ');\n}\n\nfunction singleQuote(input: string) {\n  if (input.match(/,+/i)) {\n    return input\n      .split(',')\n      .map(singleQuote)\n      .join(',');\n  }\n\n  if (input.match(/^'(.*)'$/i)) {\n    return input;\n  }\n\n  return `'${input}'`;\n}\n","const store: Record<string, any> = {};\n\nexport const cache = async <T>(key: string, resolver: () => Promise<T>): Promise<T> => {\n  if (!store[key]) {\n    const value = await resolver();\n    store[key] = value;\n  }\n  return store[key];\n};\n","import {\n  MetricFindValue,\n  DataSourceInstanceSettings,\n  DataQueryRequest,\n  ScopedVar,\n  TimeRange,\n  DataFrame,\n  AnnotationQueryRequest,\n  AnnotationEvent,\n  LoadingState,\n  ScopedVars,\n} from '@grafana/data';\nimport { map } from 'lodash';\nimport { getBackendSrv, BackendSrv, getTemplateSrv, TemplateSrv, DataSourceWithBackend } from '@grafana/runtime';\nimport { ResponseParser, DatabaseItem } from './response_parser';\nimport { AdxDataSourceOptions, KustoQuery, AdxSchema, AdxColumnSchema, defaultQuery } from './types';\nimport { getAnnotationsFromFrame } from './common/annotationsFromFrame';\nimport interpolateKustoQuery from './query_builder';\nimport { firstStringFieldToMetricFindValue } from 'common/responseHelpers';\nimport { QueryEditorPropertyExpression } from 'editor/expressions';\nimport { cache } from 'schema/cache';\n\nexport class AdxDataSource extends DataSourceWithBackend<KustoQuery, AdxDataSourceOptions> {\n  private backendSrv: BackendSrv;\n  private templateSrv: TemplateSrv;\n  private baseUrl: string;\n  private defaultOrFirstDatabase: string;\n  private url?: string;\n\n  constructor(instanceSettings: DataSourceInstanceSettings<AdxDataSourceOptions>) {\n    super(instanceSettings);\n\n    this.backendSrv = getBackendSrv();\n    this.templateSrv = getTemplateSrv();\n    this.baseUrl = '/azuredataexplorer';\n    this.defaultOrFirstDatabase = instanceSettings.jsonData.defaultDatabase;\n    this.url = instanceSettings.url;\n  }\n\n  /**\n   * Return true if it should execute\n   */\n  filterQuery(target: KustoQuery): boolean {\n    if (target.hide) {\n      return false;\n    }\n    if (typeof target.rawMode === 'undefined' && target.query) {\n      return true;\n    }\n    if (target.rawMode) {\n      return true; // anything else we can check\n    }\n\n    const tableExpr = target.expression?.from as QueryEditorPropertyExpression;\n    if (!tableExpr) {\n      return false;\n    }\n\n    const table = tableExpr.property?.name;\n    if (!table) {\n      return false; // Don't execute things without a table selected\n    }\n    return true;\n  }\n\n  applyTemplateVariables(target: KustoQuery, scopedVars: ScopedVar): Record<string, any> {\n    let q = interpolateKustoQuery(target.query, scopedVars as ScopedVars);\n\n    return {\n      ...target,\n      query: this.templateSrv.replace(q, scopedVars, this.interpolateVariable),\n      database: this.templateSrv.replace(target.database, scopedVars),\n    };\n  }\n\n  async annotationQuery(options: AnnotationQueryRequest<KustoQuery>): Promise<AnnotationEvent[]> {\n    const query = options.annotation as KustoQuery;\n    if (!query) {\n      return Promise.reject({\n        message: 'Query missing in annotation definition',\n      });\n    }\n\n    query.resultFormat = 'table';\n\n    return super\n      .query({\n        targets: [query],\n        range: options.range as TimeRange,\n        maxDataPoints: 200, // ???\n        interval: '10ms',\n        intervalMs: 10 * 1000,\n      } as DataQueryRequest<KustoQuery>)\n      .toPromise()\n      .then(res => {\n        if (res.state === LoadingState.Done) {\n          if (res.data?.length) {\n            return getAnnotationsFromFrame(res.data[0] as DataFrame, {\n              field: {\n                time: 'StartTime',\n              },\n            });\n          }\n        }\n        if (res.state === LoadingState.Error) {\n          console.log('ADX Annotation ERROR???', options, res);\n          return Promise.reject({\n            message: options.annotation.name,\n          });\n        }\n        return [];\n      });\n  }\n\n  async metricFindQuery(query: string, optionalOptions: any): Promise<MetricFindValue[]> {\n    const databasesQuery = query.match(/^databases\\(\\)/i);\n    if (databasesQuery) {\n      return this.getDatabases();\n    }\n\n    return this.getDefaultOrFirstDatabase()\n      .then(database => this.buildQuery(query, optionalOptions, database))\n      .then(query =>\n        this.query({\n          targets: [query],\n        } as DataQueryRequest<KustoQuery>).toPromise()\n      )\n      .then(response => {\n        if (response.data && response.data.length) {\n          return firstStringFieldToMetricFindValue(response.data[0]);\n        }\n        return [];\n      })\n      .catch(err => {\n        console.log('There was an error', err);\n        throw err;\n      });\n  }\n\n  async getDatabases(): Promise<DatabaseItem[]> {\n    const url = `${this.baseUrl}/v1/rest/mgmt`;\n    const req = {\n      csl: '.show databases',\n    };\n\n    return this.doRequest(url, req).then((response: any) => {\n      return new ResponseParser().parseDatabases(response);\n    });\n  }\n\n  async getDefaultOrFirstDatabase(): Promise<string> {\n    if (this.defaultOrFirstDatabase) {\n      return Promise.resolve(this.defaultOrFirstDatabase);\n    }\n\n    return this.getDatabases().then(databases => {\n      this.defaultOrFirstDatabase = databases[0].value;\n      return this.defaultOrFirstDatabase;\n    });\n  }\n\n  async getSchema(): Promise<AdxSchema> {\n    return cache(`${this.id}.schema.overview`, () => {\n      const url = `${this.baseUrl}/v1/rest/mgmt`;\n      const req = {\n        querySource: 'schema',\n        csl: `.show databases schema as json`,\n      };\n\n      return this.doRequest(url, req).then(response => {\n        return new ResponseParser().parseSchemaResult(response.data);\n      });\n    });\n  }\n\n  async getDynamicSchema(\n    database: string,\n    table: string,\n    columns: string[]\n  ): Promise<Record<string, AdxColumnSchema[]>> {\n    if (!database || !table || !Array.isArray(columns) || columns.length === 0) {\n      return {};\n    }\n    const queryParts: string[] = [];\n\n    const where = `where ${columns.map(column => `isnotnull(${column})`).join(' and ')}`;\n    const sample = `sample 100`;\n    const project = `project ${columns.map(column => column).join(', ')}`;\n    const summarize = `summarize ${columns.map(column => `buildschema(${column})`).join(', ')}`;\n\n    queryParts.push(table);\n    queryParts.push(where);\n    queryParts.push(sample);\n    queryParts.push(project);\n    queryParts.push(summarize);\n\n    const query = this.buildQuery(queryParts.join('\\n | '), {}, database);\n    const response = await this.query({\n      targets: [\n        {\n          ...query,\n          querySource: 'schema',\n        },\n      ],\n    } as DataQueryRequest<KustoQuery>).toPromise();\n\n    return dynamicSchemaParser(response.data as DataFrame[]);\n  }\n\n  get variables() {\n    return this.templateSrv.getVariables().map(v => `$${v.name}`);\n  }\n\n  // Used for annotations and templage variables\n  private buildQuery(query: string, options: any, database: string): KustoQuery {\n    if (!options) {\n      options = {};\n    }\n    if (!options.hasOwnProperty('scopedVars')) {\n      options['scopedVars'] = {};\n    }\n\n    const interpolatedQuery = interpolateKustoQuery(query, options['scopedVars']);\n\n    return {\n      ...defaultQuery,\n      refId: `adx-${interpolatedQuery}`,\n      resultFormat: 'table',\n      rawMode: true,\n      query: interpolatedQuery,\n      database,\n    };\n  }\n\n  // Used to get the schema directly\n  doRequest(url: string, data: any, maxRetries = 1) {\n    return this.backendSrv\n      .datasourceRequest({\n        url: this.url + url,\n        method: 'POST',\n        data: data,\n      })\n      .catch(error => {\n        if (maxRetries > 0) {\n          return this.doRequest(url, data, maxRetries - 1);\n        }\n\n        throw error;\n      });\n  }\n\n  interpolateVariable(value: any, variable) {\n    console.log('value', value);\n    console.log('variable', variable);\n\n    if (typeof value === 'string') {\n      if (variable.multi || variable.includeAll) {\n        return \"'\" + value + \"'\";\n      } else {\n        return value;\n      }\n    }\n\n    if (typeof value === 'number') {\n      return value;\n    }\n\n    const quotedValues = map(value, val => {\n      if (typeof value === 'number') {\n        return value;\n      }\n\n      return \"'\" + val + \"'\";\n    });\n    return quotedValues.filter(v => v !== \"''\").join(',');\n  }\n}\n\nconst dynamicSchemaParser = (frames: DataFrame[]): Record<string, AdxColumnSchema[]> => {\n  const result: Record<string, AdxColumnSchema[]> = {};\n\n  for (const frame of frames) {\n    for (const field of frame.fields) {\n      const json = JSON.parse(field.values.get(0));\n\n      if (json === null) {\n        console.log('error with field', field);\n        continue;\n      }\n\n      const columnSchemas: AdxColumnSchema[] = [];\n      const columnName = field.name.replace('schema_', '');\n      recordSchema(columnName, json, columnSchemas);\n      result[columnName] = columnSchemas;\n    }\n  }\n\n  return result;\n};\n\nconst recordSchema = (columnName: string, schema: any, result: AdxColumnSchema[]) => {\n  if (!schema) {\n    console.log('error with column', columnName);\n    return;\n  }\n\n  for (const name of Object.keys(schema)) {\n    const key = `${columnName}.${name}`;\n\n    if (typeof schema[name] === 'string') {\n      result.push({\n        Name: key,\n        CslType: schema[name],\n      });\n      continue;\n    }\n\n    if (typeof schema[name] === 'object') {\n      recordSchema(key, schema[name], result);\n    }\n  }\n};\n","import { DataFrame, MetricFindValue, FieldType } from '@grafana/data';\n\nexport function firstStringFieldToMetricFindValue(frame: DataFrame): MetricFindValue[] {\n  const values: MetricFindValue[] = [];\n  const field = frame.fields.find(f => f.type === FieldType.string);\n  if (field) {\n    for (let i = 0; i < field.values.length; i++) {\n      values.push({ text: field.values.get(i) });\n    }\n  }\n  return values;\n}\n","import { __assign } from \"tslib\";\n/* eslint-disable */\nimport { useCallback, useState, useRef } from 'react';\nimport useMountedState from './useMountedState';\nexport default function useAsyncFn(fn, deps, initialState) {\n    if (deps === void 0) { deps = []; }\n    if (initialState === void 0) { initialState = { loading: false }; }\n    var lastCallId = useRef(0);\n    var isMounted = useMountedState();\n    var _a = useState(initialState), state = _a[0], set = _a[1];\n    var callback = useCallback(function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        var callId = ++lastCallId.current;\n        set(function (prevState) { return (__assign(__assign({}, prevState), { loading: true })); });\n        return fn.apply(void 0, args).then(function (value) {\n            isMounted() && callId === lastCallId.current && set({ value: value, loading: false });\n            return value;\n        }, function (error) {\n            isMounted() && callId === lastCallId.current && set({ error: error, loading: false });\n            return error;\n        });\n    }, deps);\n    return [state, callback];\n}\n","import { useCallback, useEffect, useRef } from 'react';\nexport default function useMountedState() {\n    var mountedRef = useRef(false);\n    var get = useCallback(function () { return mountedRef.current; }, []);\n    useEffect(function () {\n        mountedRef.current = true;\n        return function () {\n            mountedRef.current = false;\n        };\n    });\n    return get;\n}\n","import { useEffect } from 'react';\nimport useAsyncFn from './useAsyncFn';\nexport default function useAsync(fn, deps) {\n    if (deps === void 0) { deps = []; }\n    var _a = useAsyncFn(fn, deps, {\n        loading: true,\n    }), state = _a[0], callback = _a[1];\n    useEffect(function () {\n        callback();\n    }, [callback]);\n    return state;\n}\n","export enum QueryEditorPropertyType {\n  Number = 'number',\n  String = 'string',\n  Boolean = 'boolean',\n  DateTime = 'dateTime',\n  Function = 'function',\n  Interval = 'interval',\n}\n\nexport interface QueryEditorProperty {\n  type: QueryEditorPropertyType;\n  name: string;\n}\n\nexport type QueryEditorOperatorType = string | boolean | number;\ntype QueryEditorOperatorValueType = QueryEditorOperatorType | QueryEditorOperatorType[];\n\nexport interface QueryEditorOperator<T = QueryEditorOperatorValueType> {\n  name: string;\n  value: T;\n}\n\nexport interface QueryEditorOperatorDefinition {\n  value: string;\n  supportTypes: QueryEditorPropertyType[];\n  multipleValues: boolean;\n  booleanValues: boolean;\n  label?: string;\n  description?: string;\n}\n\nexport interface QueryEditorPropertyDefinition {\n  value: string;\n  type: QueryEditorPropertyType;\n  label?: string;\n}\n\nexport interface QueryEditorFunctionDefinition extends QueryEditorPropertyDefinition {\n  parameters?: QueryEditorFunctionParameter[];\n}\n\nexport interface QueryEditorFunctionParameter {\n  name: string;\n  type: QueryEditorPropertyType;\n  description: string;\n  value?: string;\n}\n","import _ from 'lodash';\n\nexport interface SuggestionController {\n  _model: any;\n}\n\nexport default class KustoCodeEditor {\n  codeEditor?: monaco.editor.IStandaloneCodeEditor;\n  completionItemProvider?: monaco.IDisposable;\n  signatureHelpProvider?: monaco.IDisposable;\n\n  splitWithNewLineRegex = /[^\\n]+\\n?|\\n/g;\n  newLineRegex = /\\r?\\n/;\n  startsWithKustoPipeRegex = /^\\|\\s*/g;\n  kustoPipeRegexStrict = /^\\|\\s*$/g;\n\n  constructor(\n    private containerDiv: any,\n    private defaultTimeField: string,\n    private getSchema: () => any,\n    private config: any\n  ) {}\n\n  initMonaco(content: string) {\n    const themeName = this.config.bootData.user.lightTheme ? 'grafana-light' : 'vs-dark';\n\n    monaco.editor.defineTheme('grafana-light', {\n      base: 'vs',\n      inherit: true,\n      rules: [\n        { token: 'comment', foreground: '008000' },\n        { token: 'variable.predefined', foreground: '800080' },\n        { token: 'function', foreground: '0000FF' },\n        { token: 'operator.sql', foreground: 'FF4500' },\n        { token: 'string', foreground: 'B22222' },\n        { token: 'operator.scss', foreground: '0000FF' },\n        { token: 'variable', foreground: 'C71585' },\n        { token: 'variable.parameter', foreground: '9932CC' },\n        { token: '', foreground: '000000' },\n        { token: 'type', foreground: '0000FF' },\n        { token: 'tag', foreground: '0000FF' },\n        { token: 'annotation', foreground: '2B91AF' },\n        { token: 'keyword', foreground: '0000FF' },\n        { token: 'number', foreground: '191970' },\n        { token: 'annotation', foreground: '9400D3' },\n        { token: 'invalid', background: 'cd3131' },\n      ],\n      colors: {\n        'textCodeBlock.background': '#FFFFFF',\n      },\n    });\n\n    monaco.languages['kusto'].kustoDefaults.setLanguageSettings({\n      includeControlCommands: true,\n      newlineAfterPipe: true,\n      useIntellisenseV2: false,\n    });\n\n    this.codeEditor = monaco.editor.create(this.containerDiv, {\n      value: content || 'Write your query here',\n      // Disabling the automatic resizing until we upgrade Monaco due to perf concerns: https://github.com/microsoft/monaco-editor/issues/28\n      // automaticLayout: true,\n      language: 'kusto',\n      selectionHighlight: false,\n      theme: themeName,\n      folding: true,\n      lineNumbers: 'off',\n      lineHeight: 16,\n      suggestFontSize: 13,\n      dragAndDrop: false,\n      occurrencesHighlight: false,\n      minimap: {\n        enabled: false,\n      },\n      renderIndentGuides: false,\n      wordWrap: 'on',\n    });\n    this.codeEditor.layout();\n\n    // TODO: fix ts-ignore\n    if (monaco.editor.getModels().length === 1) {\n      this.completionItemProvider = monaco.languages.registerCompletionItemProvider('kusto', {\n        triggerCharacters: ['.', ' '],\n        // @ts-ignore\n        provideCompletionItems: this.getCompletionItems.bind(this),\n      });\n\n      this.signatureHelpProvider = monaco.languages.registerSignatureHelpProvider('kusto', {\n        signatureHelpTriggerCharacters: ['(', ')'],\n        provideSignatureHelp: this.getSignatureHelp.bind(this) as any,\n      });\n    }\n\n    this.codeEditor.createContextKey('readyToExecute', true);\n\n    this.codeEditor.onDidChangeCursorSelection(event => {\n      this.onDidChangeCursorSelection(event);\n    });\n\n    this.getSchema().then(schema => {\n      if (!schema) {\n        return;\n      }\n\n      monaco.languages['kusto'].getKustoWorker().then(workerAccessor => {\n        const model = this.codeEditor?.getModel();\n        if (!model) {\n          return;\n        }\n        workerAccessor(model.uri).then(worker => {\n          const dbName = Object.keys(schema.Databases).length > 0 ? Object.keys(schema.Databases)[0] : '';\n          worker.setSchemaFromShowSchema(schema, 'https://help.kusto.windows.net', dbName);\n          this.codeEditor?.layout();\n        });\n      });\n    });\n  }\n\n  resize() {\n    this.codeEditor?.layout();\n  }\n\n  setOnDidChangeModelContent(listener) {\n    this.codeEditor?.onDidChangeModelContent(listener);\n  }\n\n  disposeMonaco() {\n    if (this.completionItemProvider) {\n      try {\n        this.completionItemProvider.dispose();\n      } catch (e) {\n        console.error('Failed to dispose the completion item provider.', e);\n      }\n    }\n    if (this.signatureHelpProvider) {\n      try {\n        this.signatureHelpProvider.dispose();\n      } catch (e) {\n        console.error('Failed to dispose the signature help provider.', e);\n      }\n    }\n    if (this.codeEditor) {\n      try {\n        this.codeEditor.dispose();\n      } catch (e) {\n        console.error('Failed to dispose the editor component.', e);\n      }\n    }\n  }\n\n  addCommand(keybinding: number, commandFunc: monaco.editor.ICommandHandler) {\n    this.codeEditor?.addCommand(keybinding, commandFunc, 'readyToExecute');\n  }\n\n  getValue() {\n    return this.codeEditor?.getValue();\n  }\n\n  toSuggestionController(srv: monaco.editor.IEditorContribution): SuggestionController {\n    return (srv as unknown) as SuggestionController;\n  }\n\n  setEditorContent(value) {\n    this.codeEditor?.setValue(value);\n  }\n\n  getCompletionItems(model: monaco.editor.IReadOnlyModel, position: monaco.Position): any {\n    const timeFilterDocs =\n      '##### Macro that uses the selected timerange in Grafana to filter the query.\\n\\n' +\n      '- `$__timeFilter()` -> Uses the ' +\n      this.defaultTimeField +\n      ' column\\n\\n' +\n      '- `$__timeFilter(datetimeColumn)` ->  Uses the specified datetime column to build the query.';\n\n    const textUntilPosition = model.getValueInRange({\n      startLineNumber: 1,\n      startColumn: 1,\n      endLineNumber: position.lineNumber,\n      endColumn: position.column,\n    });\n\n    if (!_.includes(textUntilPosition, '|')) {\n      return [];\n    }\n\n    if (!_.includes(textUntilPosition.toLowerCase(), 'where')) {\n      return [\n        {\n          label: 'where $__timeFilter(timeColumn)',\n          kind: monaco.languages.CompletionItemKind.Keyword,\n          insertText: {\n            value: 'where \\\\$__timeFilter(${0:' + this.defaultTimeField + '})',\n          },\n          documentation: {\n            value: timeFilterDocs,\n          },\n        },\n      ];\n    }\n\n    if (_.includes(model.getLineContent(position.lineNumber).toLowerCase(), 'where')) {\n      return [\n        {\n          label: '$__timeFilter(timeColumn)',\n          kind: monaco.languages.CompletionItemKind.Keyword,\n          insertText: {\n            value: '\\\\$__timeFilter(${0:' + this.defaultTimeField + '})',\n          },\n          documentation: {\n            value: timeFilterDocs,\n          },\n        },\n        {\n          label: '$__from',\n          kind: monaco.languages.CompletionItemKind.Keyword,\n          insertText: {\n            value: `\\\\$__from`,\n          },\n          documentation: {\n            value:\n              'Built-in variable that returns the from value of the selected timerange in Grafana.\\n\\n' +\n              'Example: `where ' +\n              this.defaultTimeField +\n              ' > $__from` ',\n          },\n        },\n        {\n          label: '$__to',\n          kind: monaco.languages.CompletionItemKind.Keyword,\n          insertText: {\n            value: `\\\\$__to`,\n          },\n          documentation: {\n            value:\n              'Built-in variable that returns the to value of the selected timerange in Grafana.\\n\\n' +\n              'Example: `where ' +\n              this.defaultTimeField +\n              ' < $__to` ',\n          },\n        },\n        {\n          label: '$__timeInterval',\n          kind: monaco.languages.CompletionItemKind.Keyword,\n          insertText: {\n            value: `\\\\$__timeInterval`,\n          },\n          documentation: {\n            value:\n              '##### Built-in variable that returns an automatic time grain suitable for the current timerange.\\n\\n' +\n              'Used with the bin() function - `bin(' +\n              this.defaultTimeField +\n              ', $__timeInterval)` \\n\\n' +\n              '[Grafana docs](http://docs.grafana.org/reference/templating/#the-interval-variable)',\n          },\n        },\n      ];\n    }\n\n    return [];\n  }\n\n  getSignatureHelp(model: monaco.editor.IReadOnlyModel, position: monaco.Position, token: monaco.CancellationToken) {\n    const textUntilPosition = model.getValueInRange({\n      startLineNumber: position.lineNumber,\n      startColumn: position.column - 14,\n      endLineNumber: position.lineNumber,\n      endColumn: position.column,\n    });\n\n    if (textUntilPosition !== '$__timeFilter(') {\n      return {} as monaco.languages.SignatureHelp;\n    }\n\n    const signature: monaco.languages.SignatureHelp = {\n      activeParameter: 0,\n      activeSignature: 0,\n      signatures: [\n        {\n          label: '$__timeFilter(timeColumn)',\n          parameters: [\n            {\n              label: 'timeColumn',\n              documentation:\n                'Default is ' +\n                this.defaultTimeField +\n                ' column. Datetime column to filter data using the selected date range. ',\n            },\n          ],\n        },\n      ],\n    };\n\n    return signature;\n  }\n\n  onDidChangeCursorSelection(event) {\n    if (event.source !== 'modelChange' || event.reason !== monaco.editor.CursorChangeReason.RecoverFromMarkers) {\n      return;\n    }\n    const lastChar = this.getCharAt(event.selection.positionLineNumber, event.selection.positionColumn - 1);\n\n    if (lastChar !== ' ') {\n      return;\n    }\n\n    this.triggerSuggestions();\n  }\n\n  triggerSuggestions() {\n    const suggestController = this.codeEditor?.getContribution('editor.contrib.suggestController');\n    if (!suggestController) {\n      return;\n    }\n\n    const convertedController = this.toSuggestionController(suggestController);\n\n    convertedController._model.cancel();\n    setTimeout(() => {\n      convertedController._model.trigger(true);\n    }, 10);\n  }\n\n  getCharAt(lineNumber: number, column: number) {\n    const model = this.codeEditor?.getModel();\n    if (!model) {\n      return '';\n    }\n    if (model.getLineCount() === 0 || model.getLineCount() < lineNumber) {\n      return '';\n    }\n    const line = model.getLineContent(lineNumber);\n    if (line.length < column || column < 1) {\n      return '';\n    }\n    return line[column - 1];\n  }\n}\n","/* eslint-disable */\n/* tslint:disable */\n///<reference path=\"../../node_modules/monaco-editor/monaco.d.ts\" />\n/* tslint:enable */\n/* eslint-enable */\n\nimport React from 'react';\nimport { AdxSchema } from '../types';\nimport KustoCodeEditor from './kusto_code_editor';\nimport { css } from 'emotion';\nimport { stylesFactory } from '@grafana/ui';\n\nimport config from 'grafana/app/core/config';\n\ninterface Props {\n  content: string;\n  defaultTimeField: string;\n  pluginBaseUrl: string;\n  getSchema: () => Promise<AdxSchema>;\n  onChange: (val: string) => void;\n  onExecute: () => void;\n}\n\ninterface MonacoState {}\n\nexport class KustoMonacoEditor extends React.Component<Props, MonacoState> {\n  monacoRef: React.RefObject<HTMLDivElement>;\n  styles: { editor: string };\n  kustoCodeEditor: KustoCodeEditor | undefined;\n\n  constructor(props: Props) {\n    super(props);\n    this.styles = this.getStyles();\n    this.monacoRef = React.createRef<HTMLDivElement>();\n    this.state = {\n      content: props.content,\n    };\n\n    if (!window.hasOwnProperty('monaco')) {\n      (window as any).System.import(`/${props.pluginBaseUrl}/libs/monaco.min.js`).then(() => {\n        setTimeout(() => {\n          this.initMonaco();\n        }, 1);\n      });\n    } else {\n      setTimeout(() => {\n        this.initMonaco();\n      }, 1);\n    }\n  }\n\n  initMonaco() {\n    this.kustoCodeEditor = new KustoCodeEditor(\n      this.monacoRef.current,\n      this.props.defaultTimeField,\n      this.props.getSchema,\n      config\n    );\n\n    this.kustoCodeEditor.initMonaco(this.props.content);\n\n    /* tslint:disable:no-bitwise */\n    this.kustoCodeEditor.addCommand(monaco.KeyMod.Shift | monaco.KeyCode.Enter, () => {\n      const newValue = this.kustoCodeEditor?.getValue();\n      this.props.onChange(newValue!);\n      this.props.onExecute();\n    });\n    /* tslint:enable:no-bitwise */\n\n    this.kustoCodeEditor.setOnDidChangeModelContent(() => {\n      const newValue = this.kustoCodeEditor?.getValue();\n      this.props.onChange(newValue!);\n    });\n\n    window.onresize = () => {\n      this.kustoCodeEditor?.resize();\n    };\n  }\n\n  componentWillUnmount() {\n    if (this.kustoCodeEditor) {\n      this.kustoCodeEditor.disposeMonaco();\n    }\n  }\n\n  getStyles = stylesFactory(() => ({\n    editor: css`\n      width: 100%;\n      height: 350px;\n    `,\n  }));\n\n  render() {\n    return <div id=\"content\" tabIndex={0} className={this.styles.editor} ref={this.monacoRef}></div>;\n  }\n}\n","import React, { useCallback } from 'react';\nimport { css } from 'emotion';\nimport { SelectableValue } from '@grafana/data';\nimport { InlineFormLabel, Select, stylesFactory } from '@grafana/ui';\n\ninterface Props {\n  format: string;\n  onChangeFormat: (format: string) => void;\n  includeAdxTimeFormat: boolean;\n}\n\nconst formats: Array<SelectableValue<string>> = [\n  { label: 'Time series', value: 'time_series' },\n  { label: 'Table', value: 'table' },\n];\n\nconst adxTimeFormat: SelectableValue<string> = {\n  label: 'ADX Time series',\n  value: 'time_series_adx_series',\n};\n\nexport const QueryEditorResultFormat: React.FC<Props> = props => {\n  const onChangeFormat = useCallback(\n    (selectable: SelectableValue<string>) => {\n      if (!selectable || !selectable.value) {\n        return;\n      }\n      props.onChangeFormat(selectable.value);\n    },\n    [props.format, props.onChangeFormat]\n  );\n\n  const styles = getStyles();\n\n  return (\n    <div className={styles.container}>\n      <InlineFormLabel className=\"query-keyword\" width={6}>\n        Format as\n      </InlineFormLabel>\n      <Select\n        options={props.includeAdxTimeFormat ? [...formats, adxTimeFormat] : formats}\n        value={props.format}\n        onChange={onChangeFormat}\n      />\n    </div>\n  );\n};\n\nconst getStyles = stylesFactory(() => {\n  return {\n    container: css`\n      display: flex;\n      flex-direction: row;\n      margin-right: 4px;\n    `,\n  };\n});\n\nexport const selectResultFormat = (format?: string, includeAdxFormat?: boolean): string => {\n  const selected = formats.find(f => f.value === format);\n\n  if (includeAdxFormat && adxTimeFormat.value) {\n    if (adxTimeFormat.value === format) {\n      return adxTimeFormat.value;\n    }\n  }\n\n  if (selected && selected.value) {\n    return selected.value;\n  }\n\n  if (formats.length > 0 && formats[0].value) {\n    return formats[0].value;\n  }\n\n  return 'time_series';\n};\n","import React, { PureComponent } from 'react';\nimport { Icon, stylesFactory } from '@grafana/ui';\nimport { css } from 'emotion';\nimport { KustoQuery, AdxDataSourceOptions, AdxSchema } from 'types';\nimport { AdxDataSource } from 'datasource';\nimport { QueryEditorProps, SelectableValue } from '@grafana/data';\nimport { KustoMonacoEditor } from '../monaco/KustoMonacoEditor';\nimport { QueryEditorResultFormat, selectResultFormat } from 'components/QueryEditorResultFormat';\n\ntype Props = QueryEditorProps<AdxDataSource, KustoQuery, AdxDataSourceOptions>;\n\ninterface RawQueryEditorProps extends Props {\n  dirty?: boolean;\n  lastQueryError?: string;\n  lastQuery?: string;\n  timeNotASC?: boolean;\n  schema?: AdxSchema;\n  database: string;\n  templateVariableOptions: SelectableValue<string>;\n}\n\ninterface State {\n  showLastQuery?: boolean;\n  showHelp?: boolean;\n}\nconst defaultQuery = [\n  '//change this to create your own time series query',\n  '',\n  '<table name>',\n  '| where $__timeFilter(Timestamp)',\n  '// | summarize count() by <group by column>, bin(Timestamp, $__timeInterval)',\n  '// | order by Timestamp asc',\n].join('\\n');\n\nexport class RawQueryEditor extends PureComponent<RawQueryEditorProps, State> {\n  state: State = {};\n\n  onRawQueryChange = (kql: string) => {\n    const resultFormat = selectResultFormat(this.props.query.resultFormat);\n\n    this.props.onChange({\n      ...this.props.query,\n      query: kql,\n      database: this.props.database,\n      resultFormat,\n    });\n  };\n\n  onChangeResultFormat = (format: string) => {\n    this.props.onChange({\n      ...this.props.query,\n      resultFormat: format,\n    });\n  };\n\n  render() {\n    const { query, datasource, lastQueryError, lastQuery, timeNotASC, schema } = this.props;\n    const { showLastQuery, showHelp } = this.state;\n    const resultFormat = selectResultFormat(query.resultFormat);\n\n    const styles = getStyles();\n\n    if (!schema) {\n      return null;\n    }\n\n    return (\n      <div>\n        <KustoMonacoEditor\n          defaultTimeField=\"Timestamp\"\n          pluginBaseUrl={datasource.meta.baseUrl}\n          content={query.query || defaultQuery}\n          getSchema={async () => schema}\n          onChange={this.onRawQueryChange}\n          onExecute={this.props.onRunQuery}\n        />\n\n        <div className={styles.toolbar}>\n          <QueryEditorResultFormat\n            includeAdxTimeFormat={true}\n            format={resultFormat}\n            onChangeFormat={this.onChangeResultFormat}\n          />\n          <div className=\"gf-form\">\n            <label className=\"gf-form-label query-keyword\" onClick={() => this.setState({ showHelp: !showHelp })}>\n              Show Help <Icon name={showHelp ? 'angle-down' : 'angle-right'} />\n            </label>\n          </div>\n          <div className=\"gf-form\" ng-show=\"ctrl.lastQuery\">\n            <label\n              className=\"gf-form-label query-keyword\"\n              onClick={() => this.setState({ showLastQuery: !showLastQuery })}\n            >\n              Raw Query <Icon name={showLastQuery ? 'angle-down' : 'angle-right'} />\n            </label>\n          </div>\n\n          <div className=\"gf-form gf-form--grow\">\n            <div className=\"gf-form-label gf-form-label--grow\"></div>\n          </div>\n        </div>\n\n        {showLastQuery && (\n          <div className=\"gf-form\">\n            <pre className=\"gf-form-pre\">{lastQuery}</pre>\n          </div>\n        )}\n\n        {lastQueryError && (\n          <div className=\"gf-form\">\n            <pre className=\"gf-form-pre alert alert-error\">{lastQueryError}</pre>\n          </div>\n        )}\n\n        {timeNotASC && (\n          <div className=\"gf-form\">\n            <pre className=\"gf-form-pre alert alert-warning\">\n              Data is not sorted ascending by Time. Recommend adding an order by clause.\n            </pre>\n          </div>\n        )}\n\n        {showHelp && (\n          <div className=\"gf-form\">\n            <pre className=\"gf-form-pre alert alert-info\">\n              {`\n  Format as Table:\n  - Can return any set of columns.\n\n  Format as Time series:\n  - Requires exactly one column of Kusto type datetime. (tip: can use Kusto's project-away operator to remove columns).\n  - Requires at least one value column of a number type. Each value column is considered a metric.\n  - May optionally have one or more string columns. Each string column is considered as a key=value tag pair (where the key is the column name, and the value is the value of the column for each row).\n  - A time series is returned for each value column + unique set of string column values. Each series has name of valueColumnName { stringColumnName=columnValue, ... }. If there are no string columns in the request, the name will just be valueColumnName.\n  - Example Time Series Query:\n    AzureActivity\n      | where $__timeFilter()\n      | summarize count() by Category, bin(TimeGenerated, 60min)\n      | order by TimeGenerated asc\n\n  Format as ADX Time series:\n   - Used for queries that return Kusto's \"time series\" type, such as the make-series operator\n   - Must have a datetime column named \"Timestamp\"\n   - Example ADX Time series query:\n    let T = range Timestamp from $__timeFrom to $__timeTo step $__timeInterval * 4\n      | extend   Person = dynamic([\"Torkel\", \"Daniel\", \"Kyle\", \"Sofia\"]) \n      | extend   Place  = dynamic([\"EU\",     \"EU\",     \"US\",   \"EU\"]) \n      | mvexpand Person, Place\n      | extend   HatInventory = rand(5) \n      | project  Timestamp, tostring(Person), tostring(Place), HatInventory;\n    T | make-series avg(HatInventory) on Timestamp from $__timeFrom to $__timeTo step $__timeInterval * 4 by Person, Place;\n\n\n  Time Macros:\n  - $__timeFilter -&gt; TimeGenerated &ge; datetime(2018-06-05T18:09:58.907Z) and TimeGenerated &le; datetime(2018-06-05T20:09:58.907Z)\n  - $__timeFilter(datetimeColumn) -&gt;  datetimeColumn  &ge; datetime(2018-06-05T18:09:58.907Z) and datetimeColumn &le; datetime(2018-06-05T20:09:58.907Z)\n  - $__timeFrom -&gt;  datetime(2018-06-05T18:09:58.907Z) [the start time of the query]\n  - $__timeTo -&gt; datetime(2018-06-05T20:09:58.907Z) [the end time of the query]\n  - $__timeInterval -&gt; 5000ms [Grafana's recommended bin size based on the timespan of the query, in ms]\n\n  Templating Macros:\n  - $__escapeMulti($myTemplateVar) -&gt; $myTemplateVar should be a multi-value template variables that contains illegal characters\n  - $__contains(aColumn, $myTemplateVar) -&gt; aColumn in ($myTemplateVar)\n    If using the All option, then check the Include All Option checkbox and in the Custom all value field type in: all. If All is chosen -&gt; 1 == 1\n\n  Macro Examples:\n  - ¡ where $__timeFilter()\n  - | where TimeGenerated &ge; $__timeFrom() and TimeGenerated &le; $__timeTo()\n  - | summarize count() by Category, bin(TimeGenerated, $__timeInterval)`}\n            </pre>\n          </div>\n        )}\n      </div>\n    );\n  }\n}\n\nconst getStyles = stylesFactory(() => {\n  return {\n    toolbar: css`\n      display: flex;\n      flex-direction: row;\n      margin-top: 4px;\n    `,\n  };\n});\n","import { AdxTableSchema, AdxColumnSchema, AdxDatabaseSchema } from '../types';\nimport { QueryEditorPropertyDefinition, QueryEditorPropertyType } from '../editor/types';\nimport { SelectableValue } from '@grafana/data';\n\nexport const tableToDefinition = (table: AdxTableSchema): QueryEditorPropertyDefinition => {\n  return {\n    label: table.Name,\n    value: table.Name,\n    type: QueryEditorPropertyType.String,\n  };\n};\n\nexport const tableToSelectable = (table: AdxTableSchema): SelectableValue<string> => {\n  return {\n    label: table.Name,\n    value: table.Name,\n  };\n};\n\nexport const databaseToDefinition = (database: AdxDatabaseSchema): QueryEditorPropertyDefinition => {\n  return {\n    value: database.Name,\n    label: database.Name,\n    type: QueryEditorPropertyType.String,\n  };\n};\n\nexport const databasesToDefinition = (databases: AdxDatabaseSchema[]): QueryEditorPropertyDefinition[] => {\n  if (!Array.isArray(databases)) {\n    return [];\n  }\n  return databases.map(databaseToDefinition);\n};\n\nexport const tablesToDefinition = (tables: AdxTableSchema[]): QueryEditorPropertyDefinition[] => {\n  if (!Array.isArray(tables)) {\n    return [];\n  }\n\n  return tables.map(table => ({\n    value: table.Name,\n    label: table.Name,\n    type: QueryEditorPropertyType.String,\n  }));\n};\n\nexport const columnsToDefinition = (columns: AdxColumnSchema[]): QueryEditorPropertyDefinition[] => {\n  if (!Array.isArray(columns)) {\n    return [];\n  }\n\n  return columns.map(column => ({\n    value: column.Name,\n    label: column.Name,\n    type: toPropertyType(column.CslType),\n  }));\n};\n\nconst toPropertyType = (kustoType: string): QueryEditorPropertyType => {\n  switch (kustoType) {\n    case 'real':\n    case 'int':\n    case 'long':\n      return QueryEditorPropertyType.Number;\n    case 'datetime':\n      return QueryEditorPropertyType.DateTime;\n    case 'bool':\n      return QueryEditorPropertyType.Boolean;\n    default:\n      return QueryEditorPropertyType.String;\n  }\n};\n","import React, { PropsWithChildren } from 'react';\nimport { InlineFormLabel } from '@grafana/ui';\n\nexport interface QueryEditorSectionProps {\n  label: string;\n}\n\nexport const QueryEditorSection: React.FC<PropsWithChildren<QueryEditorSectionProps>> = props => {\n  return (\n    <div className=\"gf-form\">\n      <InlineFormLabel className=\"query-keyword\" width={12}>\n        {props.label}\n      </InlineFormLabel>\n      {props.children}\n    </div>\n  );\n};\n","import React, { useCallback, useMemo } from 'react';\nimport { css } from 'emotion';\nimport { Select, stylesFactory } from '@grafana/ui';\nimport { SelectableValue } from '@grafana/data';\nimport { QueryEditorPropertyDefinition, QueryEditorProperty, QueryEditorPropertyType } from '../../types';\n\ninterface Props {\n  fields: QueryEditorPropertyDefinition[];\n  templateVariableOptions?: SelectableValue<string>;\n  value?: QueryEditorProperty;\n  onChange: (property: QueryEditorProperty) => void;\n  placeholder?: string;\n  allowCustom?: boolean;\n}\n\nexport const definitionToProperty = (definition: QueryEditorPropertyDefinition): QueryEditorProperty => {\n  return {\n    name: definition.value,\n    type: definition.type,\n  };\n};\n\nexport const QueryEditorField: React.FC<Props> = props => {\n  const styles = getStyles();\n  const onChange = useOnChange(props);\n  const options = useOptions(props.fields);\n  const value = props.value?.name;\n\n  return (\n    <div className={styles.container}>\n      <Select\n        width={30}\n        onChange={onChange}\n        value={value}\n        options={props.templateVariableOptions ? [props.templateVariableOptions, ...options] : options}\n        placeholder={props.placeholder}\n        menuPlacement=\"bottom\"\n        allowCustomValue={props.allowCustom}\n      />\n    </div>\n  );\n};\n\nconst getStyles = stylesFactory(() => {\n  return {\n    container: css`\n      margin-right: 4px;\n    `,\n  };\n});\n\n// Should remove this when I have fixed the underlying issue in the select component\n// it should use value as label if label is missing.\nconst useOptions = (options: QueryEditorPropertyDefinition[]): Array<SelectableValue<string>> => {\n  return useMemo(() => {\n    if (!options) {\n      return [];\n    }\n\n    return options.map(option => {\n      return {\n        label: option.label ?? option.value,\n        value: option.value,\n        type: option.type,\n      };\n    });\n  }, [options]);\n};\n\nconst useOnChange = (props: Props) => {\n  return useCallback(\n    (selectable: SelectableValue<string>) => {\n      if (!selectable || typeof selectable.value !== 'string') {\n        return;\n      }\n\n      const { value } = selectable;\n      let field: QueryEditorPropertyDefinition | undefined = props.fields.find(o => o.value === value);\n\n      if (!field) {\n        field = props.templateVariableOptions?.options.find(o => o.value === value);\n      }\n\n      if (!field && value && props.allowCustom) {\n        field = {\n          value,\n          type: QueryEditorPropertyType.String,\n        };\n      }\n\n      if (field) {\n        props.onChange({\n          name: field.value,\n          type: field.type,\n        });\n      }\n    },\n    [props]\n  );\n};\n","import {\n  QueryEditorReduceExpression,\n  QueryEditorPropertyExpression,\n  QueryEditorFunctionParameterExpression,\n  QueryEditorOperatorExpression,\n  QueryEditorGroupByExpression,\n  QueryEditorExpression,\n  QueryEditorExpressionType,\n  QueryEditorArrayExpression,\n} from './expressions';\nimport { QueryEditorPropertyType, QueryEditorOperator } from './types';\n\nexport const isReduceExpression = (expression?: QueryEditorExpression): expression is QueryEditorReduceExpression => {\n  return expression?.type === QueryEditorExpressionType.Reduce;\n};\n\nexport const isFieldExpression = (expression: QueryEditorExpression): expression is QueryEditorPropertyExpression => {\n  return expression?.type === QueryEditorExpressionType.Property;\n};\n\nexport const isFunctionParameterExpression = (\n  expression?: QueryEditorExpression\n): expression is QueryEditorFunctionParameterExpression => {\n  return (expression as QueryEditorFunctionParameterExpression)?.type === QueryEditorExpressionType.FunctionParameter;\n};\n\nexport const isFieldAndOperator = (expression?: QueryEditorExpression): expression is QueryEditorOperatorExpression => {\n  return expression?.type === QueryEditorExpressionType.Operator;\n};\n\nexport const isGroupBy = (expression?: QueryEditorExpression): expression is QueryEditorGroupByExpression => {\n  return expression?.type === QueryEditorExpressionType.GroupBy;\n};\n\nexport const isDateGroupBy = (expression: QueryEditorExpression): boolean => {\n  return (expression as QueryEditorGroupByExpression)?.property?.type === QueryEditorPropertyType.DateTime;\n};\n\nexport const isBoolOperator = (operator: QueryEditorOperator | undefined): operator is QueryEditorOperator<boolean> => {\n  return typeof operator?.value === 'boolean';\n};\n\nexport const isMultiOperator = (operator?: QueryEditorOperator): operator is QueryEditorOperator<string[]> => {\n  return Array.isArray(operator?.value);\n};\n\nexport const isSingleOperator = (operator?: QueryEditorOperator): operator is QueryEditorOperator<string> => {\n  return !isMultiOperator(operator);\n};\n\nexport const isAndExpression = (expression?: QueryEditorExpression): expression is QueryEditorArrayExpression => {\n  return expression?.type === QueryEditorExpressionType.And;\n};\n\nexport const isOrExpression = (expression?: QueryEditorExpression): expression is QueryEditorArrayExpression => {\n  return expression?.type === QueryEditorExpressionType.Or;\n};\n\nexport const isArrayExpression = (expression?: QueryEditorExpression): expression is QueryEditorArrayExpression => {\n  return isAndExpression(expression) || isOrExpression(expression);\n};\n","import React from 'react';\nimport { QueryEditorPropertyType } from '../types';\nimport { QueryEditorFieldSectionProps, QueryEditorFieldSection } from 'editor/components/field/QueryEditorFieldSection';\nimport { QueryEditorPropertyExpression, QueryEditorExpressionType } from '../expressions';\n\nexport class QueryEditorFieldBuilder {\n  build(): React.FC<QueryEditorFieldSectionProps> {\n    return QueryEditorFieldSection({\n      defaultValue: this.buildFieldExpression(),\n    });\n  }\n\n  private buildFieldExpression(): QueryEditorPropertyExpression {\n    return {\n      type: QueryEditorExpressionType.Property,\n      property: {\n        name: '',\n        type: QueryEditorPropertyType.String,\n      },\n    };\n  }\n}\n","import React, { useCallback } from 'react';\nimport { SelectableValue } from '@grafana/data';\nimport { QueryEditorPropertyDefinition, QueryEditorProperty } from '../../types';\nimport { QueryEditorSection, QueryEditorSectionProps } from '../QueryEditorSection';\nimport { QueryEditorField } from './QueryEditorField';\nimport { isFieldExpression } from '../../guards';\nimport { QueryEditorExpression, QueryEditorExpressionType, QueryEditorPropertyExpression } from '../../expressions';\n\ninterface FieldSectionConfiguration {\n  defaultValue: QueryEditorExpression;\n}\n\nexport interface QueryEditorFieldSectionProps extends React.PropsWithChildren<QueryEditorSectionProps> {\n  fields: QueryEditorPropertyDefinition[];\n  templateVariableOptions: SelectableValue<string>;\n  value?: QueryEditorExpression;\n  onChange: (value: QueryEditorExpression) => void;\n}\n\nexport const QueryEditorFieldSection = (config: FieldSectionConfiguration): React.FC<QueryEditorFieldSectionProps> => {\n  return props => {\n    const expression = props.value ?? config.defaultValue;\n\n    const onChange = useCallback(\n      (property: QueryEditorProperty) => {\n        props.onChange({\n          type: QueryEditorExpressionType.Property,\n          property,\n        } as QueryEditorPropertyExpression);\n      },\n      [props.onChange]\n    );\n\n    if (!isFieldExpression(expression)) {\n      return null;\n    }\n\n    return (\n      <QueryEditorSection label={props.label}>\n        <QueryEditorField\n          fields={props.fields}\n          templateVariableOptions={props.templateVariableOptions}\n          onChange={onChange}\n          value={expression.property}\n        />\n        {props.children}\n      </QueryEditorSection>\n    );\n  };\n};\n","import React, { PureComponent } from 'react';\nimport { AsyncMultiSelect } from '@grafana/ui';\nimport { ExpressionSuggestor } from '../types';\nimport { QueryEditorOperatorDefinition, QueryEditorOperator } from '../../types';\nimport { SelectableValue } from '@grafana/data';\n\ninterface Props {\n  values: string[] | undefined;\n  onChange: (expression: QueryEditorOperator<string[]>) => void;\n  operator: QueryEditorOperatorDefinition;\n  getSuggestions: ExpressionSuggestor;\n  templateVariableOptions: SelectableValue<string>;\n}\n\nexport class QueryEditorMultiOperator extends PureComponent<Props> {\n  onCreate = (value: string) => {\n    if (!value) {\n      return;\n    }\n    // Append the new value\n    const values = [...this.props.values, value];\n    this.props.onChange({\n      value: values,\n      name: this.props.operator.value,\n    });\n  };\n\n  onChange = (selectable: any) => {\n    if (!Array.isArray(selectable)) {\n      return;\n    }\n\n    this.props.onChange({\n      value: selectable.map(s => s.value),\n      name: this.props.operator.value,\n    });\n  };\n\n  getSuggestions = (txt: string) => {\n    return this.props.getSuggestions(txt);\n  };\n\n  render() {\n    const values = this.props.values || [];\n    const current = values.map(v => {\n      return { label: v, value: v };\n    });\n\n    return (\n      <AsyncMultiSelect\n        width={30}\n        defaultOptions={[this.props.templateVariableOptions]}\n        placeholder=\"Start typing to add filters...\"\n        loadOptions={this.getSuggestions}\n        value={current}\n        onChange={this.onChange}\n        onCreateOption={this.onCreate}\n        noOptionsMessage=\"No options found\"\n        isClearable\n      />\n    );\n  }\n}\n","import React, { PureComponent } from 'react';\nimport { AsyncSelect } from '@grafana/ui';\nimport { ExpressionSuggestor } from '../types';\nimport { QueryEditorOperatorDefinition, QueryEditorOperator } from '../../types';\nimport { SelectableValue } from '@grafana/data';\n\ninterface Props {\n  value: string | undefined;\n  onChange: (operator: QueryEditorOperator) => void;\n  operator: QueryEditorOperatorDefinition;\n  getSuggestions: ExpressionSuggestor;\n  templateVariableOptions: SelectableValue<string>;\n}\nexport class QueryEditorSingleOperator extends PureComponent<Props> {\n  onChange = (evt: SelectableValue<any>) => {\n    // Handle clearing the value\n    if (evt === null) {\n      this.props.onChange({\n        value: '',\n        name: this.props.operator.value,\n      });\n      return;\n    }\n    this.props.onChange({\n      value: `${evt.value}`, // Currently strings only\n      name: this.props.operator.value,\n    });\n  };\n\n  onCreate = (value: string) => {\n    if (!value) {\n      return;\n    }\n    this.props.onChange({\n      value,\n      name: this.props.operator.value,\n    });\n  };\n\n  getSuggestions = async (txt: string) => {\n    return this.props.getSuggestions(txt);\n  };\n\n  render() {\n    const { value, templateVariableOptions } = this.props;\n    const current = value\n      ? {\n          label: value,\n          value,\n        }\n      : undefined;\n\n    return (\n      <AsyncSelect\n        width={30}\n        placeholder=\"Start typing to add filters...\"\n        loadOptions={this.getSuggestions}\n        defaultOptions={[templateVariableOptions]}\n        value={current}\n        onChange={this.onChange}\n        onCreateOption={this.onCreate}\n        allowCustomValue={true}\n        backspaceRemovesValue\n        isClearable\n        noOptionsMessage=\"No options found\"\n      />\n    );\n  }\n}\n","import React, { useCallback } from 'react';\nimport { Select } from '@grafana/ui';\nimport { SelectableValue } from '@grafana/data';\nimport { QueryEditorOperatorDefinition, QueryEditorOperator } from '../../types';\n\ninterface Props {\n  value: boolean | undefined;\n  onChange: (operator: QueryEditorOperator<boolean>) => void;\n  operator: QueryEditorOperatorDefinition;\n}\n\nconst options: Array<SelectableValue<boolean>> = [\n  { value: true, label: 'True' },\n  { value: false, label: 'False' },\n];\n\nexport const QueryEditorBoolOperator: React.FC<Props> = props => {\n  const onChange = useCallback(\n    (selectable: SelectableValue<boolean>) => {\n      if (!selectable || typeof selectable.value !== 'boolean') {\n        return;\n      }\n\n      props.onChange({\n        name: props.operator.value,\n        value: selectable.value,\n      });\n    },\n    [props]\n  );\n\n  return <Select width={15} options={options} value={props.value} onChange={onChange} menuPlacement=\"bottom\" />;\n};\n","import _ from 'lodash';\nimport { QueryEditorOperatorDefinition, QueryEditorProperty, QueryEditorPropertyType } from '../../types';\n\nexport const parseOperatorValue = (\n  property: QueryEditorProperty,\n  definition: QueryEditorOperatorDefinition,\n  value: any,\n  defaultValue: any\n) => {\n  if (definition.multipleValues) {\n    if (Array.isArray(value)) {\n      return tryToCastArrayToPropertyType(property, value);\n    }\n    return tryToCastArrayToPropertyType(property, [value]);\n  }\n\n  const casted = tryToCastToPropertyType(property, value);\n  return _.isUndefined(casted) ? defaultValue : casted;\n};\n\nconst tryToCastArrayToPropertyType = (property: QueryEditorProperty, value: any[]) => {\n  return value.reduce((all: any[], v) => {\n    const casted = tryToCastToPropertyType(property, v);\n\n    if (_.isUndefined(casted)) {\n      return all;\n    }\n\n    all.push(casted);\n    return all;\n  }, []);\n};\n\nconst tryToCastToPropertyType = (property: QueryEditorProperty, value: any) => {\n  switch (property.type) {\n    case QueryEditorPropertyType.Boolean:\n      return toBoolean(value, false);\n\n    case QueryEditorPropertyType.Number:\n      return toNumber(value, 0);\n\n    default:\n      return;\n  }\n};\n\nconst toNumber = (value: any, defaultValue: number): number => {\n  if (_.isNumber(value)) {\n    return _.toNumber(value);\n  }\n\n  if (typeof value === 'boolean') {\n    return value ? 1 : 0;\n  }\n\n  return defaultValue;\n};\n\nconst toBoolean = (value: any, defaultValue: boolean): boolean => {\n  if (typeof value === 'boolean') {\n    return value;\n  }\n\n  if (typeof value === 'string') {\n    const comparable = _.toLower(_.trim(value));\n\n    if (_.startsWith(comparable, 't')) {\n      return true;\n    }\n\n    if (_.startsWith(comparable, '1')) {\n      return true;\n    }\n\n    return false;\n  }\n\n  if (typeof value === 'number') {\n    return value > 0;\n  }\n\n  return defaultValue;\n};\n","import React, { PureComponent } from 'react';\nimport { css } from 'emotion';\nimport { Select, stylesFactory, Button } from '@grafana/ui';\nimport { SelectableValue } from '@grafana/data';\nimport { ExpressionSuggestor } from '../types';\nimport { QueryEditorOperatorDefinition, QueryEditorOperator, QueryEditorProperty } from '../../types';\nimport { QueryEditorMultiOperator } from './QueryEditorMultiOperator';\nimport { QueryEditorSingleOperator } from './QueryEditorSingleOperator';\nimport { QueryEditorBoolOperator } from './QueryEditorBoolOperator';\nimport { isMultiOperator, isBoolOperator, isSingleOperator } from '../../guards';\nimport { parseOperatorValue } from './parser';\n\ninterface Props {\n  value?: QueryEditorOperator;\n  property?: QueryEditorProperty;\n  operators: QueryEditorOperatorDefinition[];\n  onChange: (operator: QueryEditorOperator) => void;\n  getSuggestions: ExpressionSuggestor;\n  templateVariableOptions: SelectableValue<string>;\n}\n\nexport const definitionToOperator = (definition: QueryEditorOperatorDefinition): QueryEditorOperator => {\n  if (definition.booleanValues) {\n    const defaultValue: QueryEditorOperator<boolean> = {\n      name: definition.value,\n      value: false,\n    };\n\n    return defaultValue;\n  }\n\n  if (definition.multipleValues) {\n    const defaultValue: QueryEditorOperator<any[]> = {\n      name: definition.value,\n      value: [],\n    };\n\n    return defaultValue;\n  }\n\n  const defaultValue: QueryEditorOperator = {\n    name: definition.value,\n    value: '',\n  };\n\n  return defaultValue;\n};\n\nexport class QueryEditorOperatorComponent extends PureComponent<Props> {\n  onChangeOperator = (selectable: SelectableValue<string>) => {\n    if (selectable && selectable.value) {\n      const { property, value } = this.props;\n      const definition = this.props.operators.find(o => o.value === selectable.value);\n\n      if (!definition || !property) {\n        return;\n      }\n\n      if (!value) {\n        this.props.onChange(definitionToOperator(definition));\n        return;\n      }\n\n      const operator = definitionToOperator(definition);\n      const defaultValue = operator.value;\n      const currentValue = value.value;\n      operator.value = parseOperatorValue(property, definition, currentValue, defaultValue);\n\n      this.props.onChange(operator);\n    }\n  };\n\n  onChangeValue = (operator: QueryEditorOperator) => {\n    this.props.onChange(operator);\n  };\n\n  render() {\n    const { operators, value, getSuggestions, templateVariableOptions } = this.props;\n    const styles = getStyles();\n    const definition = operators.find(o => o.value === value?.name);\n\n    return (\n      <>\n        <div className={styles.container}>\n          <Select\n            isSearchable={true}\n            options={operators}\n            value={definition?.value}\n            onChange={this.onChangeOperator}\n            menuPlacement=\"bottom\"\n            renderControl={React.forwardRef(({ value, isOpen, invalid, ...otherProps }, ref) => {\n              return (\n                <Button ref={ref} {...otherProps} variant=\"secondary\">\n                  {definition?.label || definition?.value || '?'}\n                </Button>\n              );\n            })}\n          />\n        </div>\n        {renderOperatorInput(definition, value, this.onChangeValue, getSuggestions, templateVariableOptions)}\n      </>\n    );\n  }\n}\n\nconst renderOperatorInput = (\n  definition: QueryEditorOperatorDefinition | undefined,\n  operator: QueryEditorOperator | undefined,\n  onChangeValue: (expression: QueryEditorOperator) => void,\n  getSuggestions: ExpressionSuggestor,\n  templateVariableOptions: SelectableValue<string>\n) => {\n  if (!definition) {\n    return null;\n  }\n\n  const styles = getStyles();\n\n  if (definition.multipleValues && (isMultiOperator(operator) || !operator)) {\n    return (\n      <div className={styles.container}>\n        <QueryEditorMultiOperator\n          operator={definition}\n          values={operator?.value ?? []}\n          onChange={onChangeValue}\n          getSuggestions={getSuggestions}\n          templateVariableOptions={templateVariableOptions}\n        />\n      </div>\n    );\n  }\n\n  if (definition.booleanValues && (isBoolOperator(operator) || !operator)) {\n    return (\n      <div className={styles.container}>\n        <QueryEditorBoolOperator operator={definition} value={operator?.value} onChange={onChangeValue} />\n      </div>\n    );\n  }\n\n  if (!definition.multipleValues && (isSingleOperator(operator) || !operator)) {\n    return (\n      <div className={styles.container}>\n        <QueryEditorSingleOperator\n          operator={definition}\n          value={operator?.value}\n          onChange={onChangeValue}\n          getSuggestions={getSuggestions}\n          templateVariableOptions={templateVariableOptions}\n        />\n      </div>\n    );\n  }\n\n  return null;\n};\n\nconst getStyles = stylesFactory(() => {\n  return {\n    container: css`\n      margin-right: 4px;\n    `,\n  };\n});\n","import React, { PureComponent } from 'react';\nimport { css } from 'emotion';\nimport _ from 'lodash';\nimport { stylesFactory } from '@grafana/ui';\nimport { SkippableExpressionSuggestor } from '../types';\nimport {\n  QueryEditorPropertyDefinition,\n  QueryEditorOperatorDefinition,\n  QueryEditorProperty,\n  QueryEditorOperator,\n} from '../../types';\nimport { QueryEditorField } from '../field/QueryEditorField';\nimport { QueryEditorOperatorComponent, definitionToOperator } from '../operators/QueryEditorOperator';\nimport { SelectableValue } from '@grafana/data';\nimport { QueryEditorOperatorExpression } from '../../expressions';\nimport { parseOperatorValue } from '../operators/parser';\nimport debounce from 'debounce-promise';\n\ninterface Props {\n  value?: QueryEditorOperatorExpression;\n  fields: QueryEditorPropertyDefinition[];\n  templateVariableOptions: SelectableValue<string>;\n  operators: QueryEditorOperatorDefinition[];\n  onChange: (expression: QueryEditorOperatorExpression) => void;\n  getSuggestions: SkippableExpressionSuggestor;\n}\n\ninterface State {\n  // operators we can use for the field\n  operators: QueryEditorOperatorDefinition[];\n}\n\nexport class QueryEditorFieldAndOperator extends PureComponent<Props, State> {\n  state: State = { operators: [] };\n\n  componentDidMount = () => {\n    const field = this.props.value?.property;\n    if (field) {\n      this.updateOperators(field);\n    }\n  };\n\n  // Find the valid operators to the given field and save it in state\n  updateOperators = (field: QueryEditorProperty): QueryEditorOperatorDefinition[] => {\n    const operators: QueryEditorOperatorDefinition[] = [];\n    for (const op of this.props.operators) {\n      if (op.supportTypes.includes(field.type)) {\n        operators.push(op);\n      }\n    }\n    this.setState({ operators });\n    return operators;\n  };\n\n  onFieldChanged = (property: QueryEditorProperty) => {\n    let next: QueryEditorOperatorExpression = {\n      ...this.props.value!,\n      property,\n    };\n\n    const operators = this.updateOperators(property);\n    const currentOperator = next.operator?.name;\n    const definition = operators.find(op => op.value === currentOperator);\n\n    if (operators.length && !definition) {\n      next.operator = definitionToOperator(operators[0]);\n      const defaultValue = next.operator.value;\n      const currentValue = this.props.value?.operator.value;\n      next.operator.value = parseOperatorValue(next.property, operators[0], currentValue, defaultValue);\n    }\n\n    if (!definition) {\n      return this.props.onChange(next);\n    }\n\n    // Give it default values\n    next.operator = definitionToOperator(definition);\n    const defaultValue = next.operator.value;\n    const currentValue = this.props.value?.operator.value;\n    next.operator.value = parseOperatorValue(next.property, definition, currentValue, defaultValue);\n    this.props.onChange(next);\n  };\n\n  onOperatorChange = (operator: QueryEditorOperator) => {\n    this.props.onChange({\n      ...this.props.value!,\n      operator,\n    });\n  };\n\n  getSuggestions = debounce(\n    async (txt: string) => {\n      const column = this.props.value?.property.name;\n      const results = await this.props.getSuggestions(txt, column);\n\n      if (Array.isArray(this.props.templateVariableOptions?.options)) {\n        const variables = this.props.templateVariableOptions.options.filter(v => {\n          if (typeof v?.value === 'string') {\n            return v.value.indexOf(txt) > -1;\n          }\n          return false;\n        });\n\n        Array.prototype.push.apply(results, variables);\n      }\n\n      return results;\n    },\n    500,\n    { leading: false }\n  );\n\n  render() {\n    const { value, fields, templateVariableOptions } = this.props;\n    const { operators } = this.state;\n\n    const styles = getStyles();\n    const showOperators = value?.operator || value?.property;\n\n    return (\n      <div className={styles.container}>\n        <QueryEditorField\n          value={value?.property}\n          fields={fields}\n          templateVariableOptions={templateVariableOptions}\n          onChange={this.onFieldChanged}\n          placeholder=\"Choose column...\"\n        />\n        {showOperators && (\n          <QueryEditorOperatorComponent\n            value={value?.operator}\n            operators={operators}\n            onChange={this.onOperatorChange}\n            getSuggestions={this.getSuggestions}\n            property={value?.property}\n            templateVariableOptions={templateVariableOptions}\n          />\n        )}\n      </div>\n    );\n  }\n}\n\nconst getStyles = stylesFactory(() => {\n  return {\n    container: css`\n      display: flex;\n      flex-direction: row;\n    `,\n  };\n});\n","import React, { useCallback } from 'react';\nimport { QueryEditorExpression, QueryEditorArrayExpression } from '../expressions';\n\ninterface Props {\n  id: string;\n  value: QueryEditorArrayExpression;\n  onChange: (value: QueryEditorArrayExpression) => void;\n  children: (props: ChildProps) => React.ReactElement | null;\n}\n\ninterface ChildProps {\n  index: number;\n  onChange: (value: QueryEditorExpression) => void;\n  onRemove: () => void;\n  onAdd: (value: QueryEditorExpression) => void;\n  value?: QueryEditorExpression;\n}\n\nexport const QueryEditorRepeater: React.FC<Props> = props => {\n  const onChange = useCallback(\n    (index: number, expression?: QueryEditorExpression) => {\n      const { expressions } = props.value;\n      const next = Array.from(expressions);\n\n      if (expression) {\n        next.splice(index, 1, expression);\n      } else {\n        next.splice(index, 1);\n      }\n\n      props.onChange({\n        ...props.value,\n        expressions: next,\n      });\n    },\n    [props.children, props.onChange, props.value]\n  );\n\n  if (!props.value?.expressions) {\n    return null;\n  }\n\n  return (\n    <>\n      {props.value.expressions.map((value, index) => {\n        return (\n          <React.Fragment key={`${props.id}-${index}`}>\n            {props.children({\n              index,\n              value,\n              onChange: (expression: QueryEditorExpression) => onChange(index, expression),\n              onAdd: (expression: QueryEditorExpression) => onChange(props.value.expressions.length, expression),\n              onRemove: () => onChange(index),\n            })}\n          </React.Fragment>\n        );\n      })}\n    </>\n  );\n};\n","import React from 'react';\nimport { css } from 'emotion';\nimport { QueryEditorOperatorDefinition, QueryEditorPropertyDefinition } from '../../types';\nimport { QueryEditorSectionProps, QueryEditorSection } from '../QueryEditorSection';\nimport { SelectableValue } from '@grafana/data';\nimport { SkippableExpressionSuggestor } from '../types';\nimport {\n  QueryEditorArrayExpression,\n  QueryEditorOperatorExpression,\n  QueryEditorExpressionType,\n} from '../../expressions';\nimport { isFieldAndOperator, isOrExpression } from 'editor/guards';\nimport { QueryEditorFieldAndOperator } from './QueryEditorFieldAndOperator';\nimport { Button, Select, stylesFactory, InlineFormLabel } from '@grafana/ui';\nimport { QueryEditorRepeater } from '../QueryEditorRepeater';\n\ninterface FilterSectionConfiguration {\n  operators: QueryEditorOperatorDefinition[];\n  defaultValue: QueryEditorOperatorExpression;\n}\n\nexport interface QueryEditorFilterSectionProps extends QueryEditorSectionProps {\n  fields: QueryEditorPropertyDefinition[];\n  templateVariableOptions: SelectableValue<string>;\n  value: QueryEditorArrayExpression;\n  onChange: (value: QueryEditorArrayExpression) => void;\n  getSuggestions: SkippableExpressionSuggestor;\n}\n\nexport const QueryEditorFilterSection = (\n  config: FilterSectionConfiguration\n): React.FC<QueryEditorFilterSectionProps> => {\n  return props => {\n    const styles = getStyles();\n\n    if (props.value?.expressions?.length === 0) {\n      return (\n        <QueryEditorSection label={props.label}>\n          <Button\n            variant=\"secondary\"\n            onClick={() => {\n              const next: QueryEditorArrayExpression = {\n                ...props.value,\n                expressions: [\n                  {\n                    type: QueryEditorExpressionType.Or,\n                    expressions: [config.defaultValue],\n                  } as QueryEditorArrayExpression,\n                ],\n              };\n\n              props.onChange(next);\n            }}\n            icon=\"plus\"\n          />\n        </QueryEditorSection>\n      );\n    }\n\n    return (\n      <QueryEditorRepeater id=\"filter-and\" value={props.value} onChange={props.onChange}>\n        {filterProps => {\n          if (!isOrExpression(filterProps.value)) {\n            return null;\n          }\n\n          if (filterProps.value?.expressions?.length === 0) {\n            if (filterProps.index > 0) {\n              return null;\n            }\n\n            return (\n              <QueryEditorSection label={props.label}>\n                <Button\n                  variant=\"secondary\"\n                  onClick={() => {\n                    const expression: QueryEditorArrayExpression = {\n                      type: QueryEditorExpressionType.Or,\n                      expressions: [config.defaultValue],\n                    };\n\n                    filterProps.onChange(expression);\n                  }}\n                  icon=\"plus\"\n                />\n              </QueryEditorSection>\n            );\n          }\n\n          return (\n            <QueryEditorSection label={props.label}>\n              <div className={styles.container}>\n                <QueryEditorRepeater id=\"filter-or\" value={filterProps.value} onChange={filterProps.onChange}>\n                  {operatorProps => {\n                    if (!isFieldAndOperator(operatorProps.value)) {\n                      console.log('invalid fieldandoperator-expression');\n                      return null;\n                    }\n\n                    const isFirst = operatorProps.index === 0;\n                    const rowStyles = isFirst ? styles.row : styles.rowWithSpacing;\n\n                    return (\n                      <div className={rowStyles}>\n                        {!isFirst && (\n                          <InlineFormLabel className=\"query-keyword\" width={3}>\n                            or\n                          </InlineFormLabel>\n                        )}\n                        <QueryEditorFieldAndOperator\n                          value={operatorProps.value}\n                          operators={config.operators}\n                          fields={props.fields}\n                          templateVariableOptions={props.templateVariableOptions}\n                          onChange={operatorProps.onChange}\n                          getSuggestions={props.getSuggestions}\n                        />\n                        <div className={styles.spacing}>\n                          <Button variant=\"secondary\" onClick={operatorProps.onRemove} icon=\"minus\" />\n                        </div>\n                        {isFirst && (\n                          <Select\n                            isSearchable={true}\n                            options={[\n                              {\n                                value: 'append-row',\n                                label: 'OR - include another option',\n                              },\n                              {\n                                value: 'new-row',\n                                label: `AND - add a new \"${props.label}\" clause`,\n                              },\n                            ]}\n                            onChange={value => {\n                              if (value?.value === 'append-row') {\n                                return operatorProps.onAdd(config.defaultValue);\n                              }\n\n                              if (value?.value === 'new-row') {\n                                return filterProps.onAdd({\n                                  type: QueryEditorExpressionType.Or,\n                                  expressions: [config.defaultValue],\n                                } as QueryEditorArrayExpression);\n                              }\n                            }}\n                            menuPlacement=\"bottom\"\n                            renderControl={React.forwardRef(({ value, isOpen, invalid, ...otherProps }, ref) => {\n                              return <Button ref={ref} {...otherProps} variant=\"secondary\" icon=\"plus\" />;\n                            })}\n                          />\n                        )}\n                      </div>\n                    );\n                  }}\n                </QueryEditorRepeater>\n              </div>\n            </QueryEditorSection>\n          );\n        }}\n      </QueryEditorRepeater>\n    );\n  };\n};\n\nconst getStyles = stylesFactory(() => {\n  const row = css`\n    display: flex;\n    flex-direction: row;\n  `;\n\n  return {\n    container: css`\n      display: flex;\n      flex-direction: column;\n    `,\n    row: row,\n    rowWithSpacing: css`\n      ${row}\n      margin-top: 4px;\n    `,\n    spacing: css`\n      margin-right: 4px;\n    `,\n  };\n});\n","import { QueryEditorOperatorDefinition, QueryEditorPropertyType } from '../types';\n\nexport class QueyEditorOperatorBuilder {\n  private label: string;\n  private description: string;\n  private types: QueryEditorPropertyType[];\n  private multiple: boolean;\n  private bool: boolean;\n\n  constructor(private value: string, private operators: QueryEditorOperatorDefinition[]) {\n    this.label = value;\n    this.types = [];\n    this.description = '';\n    this.multiple = false;\n    this.bool = false;\n  }\n\n  withLabel(label: string) {\n    this.label = label;\n    return this;\n  }\n\n  withDescription(description: string) {\n    this.description = description;\n    return this;\n  }\n\n  supportTypes(types: QueryEditorPropertyType[]) {\n    this.types = types;\n    return this;\n  }\n\n  multipleValues(multiple: boolean) {\n    this.multiple = multiple;\n    return this;\n  }\n\n  booleanValues(bool: boolean) {\n    this.bool = bool;\n    return this;\n  }\n\n  add(): void {\n    this.operators.push({\n      value: this.value,\n      supportTypes: this.types,\n      label: this.label,\n      description: this.description,\n      multipleValues: this.multiple,\n      booleanValues: this.bool,\n    });\n  }\n}\n","import React from 'react';\nimport { QueryEditorFilterSectionProps, QueryEditorFilterSection } from '../components/filter/QueryEditorFilterSection';\nimport { QueryEditorOperatorDefinition, QueryEditorPropertyType, QueryEditorProperty } from '../types';\nimport { QueyEditorOperatorBuilder } from './QueryEditorOperatorBuilder';\nimport { QueryEditorOperatorExpression, QueryEditorExpressionType } from '../expressions';\nimport { definitionToOperator } from '../components/operators/QueryEditorOperator';\n\nexport class QueryEditorFilterBuilder {\n  private operators: QueryEditorOperatorDefinition[];\n  //private multipleRows: boolean;\n\n  constructor() {\n    this.operators = [];\n    // this.multipleRows = false;\n  }\n\n  withOperators(operators: (builder: (value: string) => QueyEditorOperatorBuilder) => void) {\n    operators(value => new QueyEditorOperatorBuilder(value, this.operators));\n    return this;\n  }\n\n  withMultipleRows(value: boolean) {\n    // this.multipleRows = value;\n    return this;\n  }\n\n  build(): React.FC<QueryEditorFilterSectionProps> {\n    return QueryEditorFilterSection({\n      operators: this.operators,\n      defaultValue: this.buildOperatorExpression(),\n    });\n  }\n\n  private buildOperatorExpression(): QueryEditorOperatorExpression {\n    const operator = this.operators[0];\n\n    return {\n      type: QueryEditorExpressionType.Operator,\n      property: this.buildFieldExpression(),\n      operator: definitionToOperator(operator),\n    };\n  }\n\n  private buildFieldExpression(): QueryEditorProperty {\n    return {\n      name: '',\n      type: QueryEditorPropertyType.String,\n    };\n  }\n}\n","import React, { useState, useCallback } from 'react';\nimport { Input } from '@grafana/ui';\nimport { QueryEditorPropertyType } from '../../types';\nimport { QueryEditorFunctionParameterExpression, QueryEditorExpressionType } from '../../expressions';\n\ninterface Props {\n  name: string;\n  value: string | undefined;\n  fieldType: QueryEditorPropertyType;\n  description: string;\n  onChange: (expression: QueryEditorFunctionParameterExpression) => void;\n}\n\nexport const QueryEditorFunctionParameterSection: React.FC<Props> = props => {\n  const [value, setValue] = useState(props.value ?? '');\n\n  const onChange = useCallback(\n    (event: React.FormEvent<HTMLInputElement>) => {\n      if (!event || !event.currentTarget) {\n        return;\n      }\n      setValue(event.currentTarget.value);\n    },\n    [setValue]\n  );\n\n  const onBlur = useCallback(() => {\n    props.onChange({\n      type: QueryEditorExpressionType.FunctionParameter,\n      fieldType: props.fieldType,\n      value: value,\n      name: props.name,\n    });\n  }, [value, props]);\n\n  return <Input width={20} value={value} placeholder={props.description} onChange={onChange} onBlur={onBlur} />;\n};\n","import React, { useCallback, useEffect, useState } from 'react';\nimport { css } from 'emotion';\nimport { InlineFormLabel, stylesFactory } from '@grafana/ui';\nimport {\n  QueryEditorPropertyDefinition,\n  QueryEditorFunctionDefinition,\n  QueryEditorFunctionParameter,\n  QueryEditorPropertyType,\n  QueryEditorProperty,\n} from '../../types';\nimport { QueryEditorField } from '../field/QueryEditorField';\nimport { SelectableValue } from '@grafana/data';\nimport { QueryEditorFunctionParameterSection } from '../field/QueryEditorFunctionParameterSection';\nimport {\n  QueryEditorReduceExpression,\n  QueryEditorFunctionParameterExpression,\n  QueryEditorExpressionType,\n} from '../../expressions';\n\ninterface Props {\n  fields: QueryEditorPropertyDefinition[];\n  templateVariableOptions: SelectableValue<string>;\n  functions: QueryEditorFunctionDefinition[];\n  value?: QueryEditorReduceExpression;\n  label?: string;\n  onChange: (expression: QueryEditorReduceExpression) => void;\n}\n\nexport const QueryEditorReduce: React.FC<Props> = props => {\n  const [field, setField] = useState(props.value?.property);\n  const [reduce, setReduce] = useState(props.value?.reduce);\n  const [parameters, setParameters] = useState(props.value?.parameters);\n  const styles = getStyles();\n\n  const onChangeField = useCallback(\n    (property: QueryEditorProperty) => {\n      setField(property);\n\n      // Set a reasonable value\n      if (!props.value?.reduce?.name) {\n        let reducer = props.functions.find(f => f.value === 'avg');\n        if (!reducer) {\n          reducer = props.functions[0];\n        }\n        setReduce({\n          name: reducer.value,\n          type: QueryEditorPropertyType.Function,\n        });\n      }\n    },\n    [setField]\n  );\n\n  const onChangeReduce = useCallback(\n    (property: QueryEditorProperty) => {\n      setReduce(property);\n    },\n    [setReduce]\n  );\n\n  const onChangeParameter = useCallback(\n    (expression: QueryEditorFunctionParameterExpression[]) => {\n      setParameters(expression);\n    },\n    [setParameters]\n  );\n\n  useEffect(() => {\n    if (field && reduce) {\n      const payload: QueryEditorReduceExpression = {\n        type: QueryEditorExpressionType.Reduce,\n        property: field,\n        reduce,\n        parameters: parameters,\n      };\n\n      props.onChange(payload);\n    }\n  }, [field, reduce, parameters]);\n\n  const reduceParameters: QueryEditorFunctionParameter[] = getParameters(reduce, props.functions);\n\n  return (\n    <div className={styles.container}>\n      <QueryEditorField\n        value={field}\n        fields={props.fields}\n        templateVariableOptions={props.templateVariableOptions}\n        onChange={onChangeField}\n        placeholder=\"Choose column...\"\n      />\n      <InlineFormLabel className=\"query-keyword\">{props.label ?? 'aggregate by'}</InlineFormLabel>\n      <QueryEditorField\n        value={reduce}\n        fields={props.functions}\n        onChange={onChangeReduce}\n        placeholder=\"Choose aggregation function...\"\n      />\n      {reduceParameters &&\n        reduceParameters.map(param => {\n          return (\n            <QueryEditorFunctionParameterSection\n              key={param.name}\n              name={param.name}\n              value={props.value?.parameters?.find(p => p.name === param.name)?.value}\n              description={param.description}\n              fieldType={param.type}\n              onChange={val => onChangeParameter([val])}\n            />\n          );\n        })}\n    </div>\n  );\n};\n\nconst getStyles = stylesFactory(() => {\n  return {\n    container: css`\n      display: flex;\n      flex-direction: row;\n    `,\n  };\n});\n\nconst getParameters = (\n  reduce: QueryEditorProperty | undefined,\n  functions: QueryEditorFunctionDefinition[]\n): QueryEditorFunctionParameter[] => {\n  if (!reduce) {\n    return [];\n  }\n  const func = functions.find(func => func.value === reduce.name);\n\n  return func?.parameters || [];\n};\n","import React from 'react';\nimport { css } from 'emotion';\nimport { QueryEditorPropertyDefinition } from '../../types';\nimport { QueryEditorSection, QueryEditorSectionProps } from '../QueryEditorSection';\nimport { SelectableValue } from '@grafana/data';\nimport { ExpressionSuggestor } from '../types';\nimport { QueryEditorExpression, QueryEditorArrayExpression } from '../../expressions';\nimport { isReduceExpression } from 'editor/guards';\nimport { QueryEditorReduce } from './QueryEditorReduce';\nimport { Button, stylesFactory } from '@grafana/ui';\nimport { QueryEditorRepeater } from '../QueryEditorRepeater';\n\ninterface ReduceSectionConfiguration {\n  defaultValue: QueryEditorExpression;\n  functions: QueryEditorPropertyDefinition[];\n}\n\nexport interface QueryEditorReduceSectionProps extends QueryEditorSectionProps {\n  fields: QueryEditorPropertyDefinition[];\n  templateVariableOptions: SelectableValue<string>;\n  value: QueryEditorArrayExpression;\n  getSuggestions: ExpressionSuggestor;\n  onChange: (value: QueryEditorArrayExpression) => void;\n}\n\nexport const QueryEditorReduceSection = (\n  config: ReduceSectionConfiguration\n): React.FC<QueryEditorReduceSectionProps> => {\n  return props => {\n    const styles = getStyles();\n\n    if (props.value.expressions.length === 0) {\n      return (\n        <QueryEditorSection label={props.label}>\n          <Button\n            variant=\"secondary\"\n            onClick={() => {\n              const expression: QueryEditorArrayExpression = {\n                ...props.value,\n                expressions: [config.defaultValue],\n              };\n              props.onChange(expression);\n            }}\n            icon=\"plus\"\n          />\n        </QueryEditorSection>\n      );\n    }\n\n    return (\n      <QueryEditorSection label={props.label}>\n        <div className={styles.container}>\n          <QueryEditorRepeater id=\"reduce\" onChange={props.onChange} value={props.value}>\n            {childProps => {\n              if (!isReduceExpression(childProps.value)) {\n                return null;\n              }\n\n              const isFirst = childProps.index === 0;\n              const rowStyle = isFirst ? styles.row : styles.rowWithSpacing;\n\n              return (\n                <div className={rowStyle}>\n                  <QueryEditorReduce\n                    onChange={childProps.onChange}\n                    value={childProps.value}\n                    templateVariableOptions={props.templateVariableOptions}\n                    fields={props.fields}\n                    functions={config.functions}\n                  />\n                  <Button className={styles.spacing} variant=\"secondary\" onClick={childProps.onRemove} icon=\"minus\" />\n                  {isFirst && (\n                    <Button variant=\"secondary\" onClick={() => childProps.onAdd(config.defaultValue)} icon=\"plus\" />\n                  )}\n                </div>\n              );\n            }}\n          </QueryEditorRepeater>\n        </div>\n      </QueryEditorSection>\n    );\n  };\n};\n\nconst getStyles = stylesFactory(() => {\n  const row = css`\n    display: flex;\n    flex-direction: row;\n  `;\n\n  return {\n    container: css`\n      display: flex;\n      flex-direction: column;\n    `,\n    row: row,\n    rowWithSpacing: css`\n      ${row}\n      margin-top: 4px;\n    `,\n    spacing: css`\n      margin-right: 4px;\n    `,\n  };\n});\n","import { QueryEditorPropertyType, QueryEditorFunctionDefinition, QueryEditorFunctionParameter } from '../types';\n\nexport class QueryEditorFunctionBuilder {\n  private label: string;\n  private parameters: QueryEditorFunctionParameter[] = [];\n\n  constructor(private value: string, private functions: QueryEditorFunctionDefinition[]) {\n    this.label = value;\n  }\n\n  withLabel(label: string) {\n    this.label = label;\n    return this;\n  }\n\n  withParameter(name: string, type: QueryEditorPropertyType, description: string) {\n    this.parameters.push({ name, type, description });\n    return this;\n  }\n\n  add(): void {\n    this.functions.push({\n      value: this.value,\n      label: this.label,\n      type: QueryEditorPropertyType.Function,\n      parameters: this.parameters,\n    });\n  }\n}\n","import React from 'react';\nimport { QueryEditorFunctionDefinition, QueryEditorPropertyType, QueryEditorProperty } from '../types';\nimport { QueryEditorReduceSection, QueryEditorReduceSectionProps } from '../components/reduce/QueryEditorReduceSection';\nimport { QueryEditorFunctionBuilder } from './QueryEditorFunctionBuilder';\nimport { QueryEditorReduceExpression, QueryEditorExpressionType } from '../expressions';\n\nexport class QueryEditorReduceBuilder {\n  private functions: QueryEditorFunctionDefinition[];\n\n  constructor() {\n    this.functions = [];\n  }\n\n  withMultipleRows(value: boolean) {\n    return this;\n  }\n\n  withFunctions(functions: (builder: (value: string) => QueryEditorFunctionBuilder) => void) {\n    functions(value => new QueryEditorFunctionBuilder(value, this.functions));\n    return this;\n  }\n\n  build(): React.FC<QueryEditorReduceSectionProps> {\n    return QueryEditorReduceSection({\n      functions: this.functions,\n      defaultValue: this.buildReduceExpression(),\n    });\n  }\n\n  private buildReduceExpression(): QueryEditorReduceExpression {\n    return {\n      type: QueryEditorExpressionType.Reduce,\n      property: this.buildProperty(QueryEditorPropertyType.String),\n      reduce: this.buildProperty(QueryEditorPropertyType.Function),\n    };\n  }\n\n  private buildProperty(type: QueryEditorPropertyType): QueryEditorProperty {\n    return {\n      name: '',\n      type,\n    };\n  }\n}\n","import React, { useCallback, useEffect, useState } from 'react';\nimport { css } from 'emotion';\nimport { stylesFactory } from '@grafana/ui';\nimport { QueryEditorPropertyDefinition, QueryEditorPropertyType, QueryEditorProperty } from '../../types';\nimport { QueryEditorField } from '../field/QueryEditorField';\nimport { SelectableValue } from '@grafana/data';\nimport { QueryEditorGroupByExpression, QueryEditorExpressionType } from '../../expressions';\n\ninterface Props {\n  fields: QueryEditorPropertyDefinition[];\n  templateVariableOptions: SelectableValue<string>;\n  intervals: QueryEditorPropertyDefinition[];\n  value?: QueryEditorGroupByExpression;\n  onChange: (expression: QueryEditorGroupByExpression) => void;\n}\n\nexport const QueryEditorGroupBy: React.FC<Props> = props => {\n  const [field, setField] = useState(props.value?.property);\n  const [interval, setInterval] = useState(props.value?.interval);\n  const styles = getStyles();\n\n  const onChangeField = useCallback(\n    (property: QueryEditorProperty) => {\n      setField(property);\n      if (property.type === QueryEditorPropertyType.DateTime) {\n        setInterval({\n          type: QueryEditorPropertyType.Interval,\n          name: props.intervals[0].value,\n        });\n      }\n    },\n    [setField]\n  );\n\n  const onChangeInterval = useCallback(\n    (property: QueryEditorProperty) => {\n      setInterval(property);\n    },\n    [setInterval]\n  );\n\n  useEffect(() => {\n    if (field) {\n      const payload: QueryEditorGroupByExpression = {\n        type: QueryEditorExpressionType.GroupBy,\n        property: field,\n        interval,\n      };\n\n      props.onChange(payload);\n    }\n  }, [field, interval]);\n\n  return (\n    <div className={styles.container}>\n      <QueryEditorField\n        value={field}\n        fields={props.fields}\n        templateVariableOptions={props.templateVariableOptions}\n        onChange={onChangeField}\n        placeholder=\"Choose column...\"\n      />\n      {field?.type === QueryEditorPropertyType.DateTime && (\n        <QueryEditorField\n          value={interval}\n          fields={props.intervals}\n          templateVariableOptions={props.templateVariableOptions}\n          onChange={onChangeInterval}\n          placeholder=\"Choose interval\"\n          allowCustom={true}\n        />\n      )}\n    </div>\n  );\n};\n\nconst getStyles = stylesFactory(() => {\n  return {\n    container: css`\n      display: flex;\n      flex-direction: row;\n    `,\n  };\n});\n","import React from 'react';\nimport { SelectableValue } from '@grafana/data';\nimport { Button, stylesFactory } from '@grafana/ui';\nimport { css } from 'emotion';\nimport { QueryEditorPropertyDefinition } from '../../types';\nimport { QueryEditorSection, QueryEditorSectionProps } from '../QueryEditorSection';\nimport { ExpressionSuggestor } from '../types';\nimport { QueryEditorExpression, QueryEditorArrayExpression } from '../../expressions';\nimport { QueryEditorRepeater } from '../QueryEditorRepeater';\nimport { isGroupBy } from '../../guards';\nimport { QueryEditorGroupBy } from './QueryEditorGroupBy';\n\ninterface GroupBySectionConfiguration {\n  defaultValue: QueryEditorExpression;\n  intervals: QueryEditorPropertyDefinition[];\n}\n\nexport interface QueryEditorGroupBySectionProps extends QueryEditorSectionProps {\n  fields: QueryEditorPropertyDefinition[];\n  templateVariableOptions: SelectableValue<string>;\n  value: QueryEditorArrayExpression;\n  onChange: (value: QueryEditorArrayExpression) => void;\n  getSuggestions: ExpressionSuggestor;\n}\n\nexport const QueryEditorGroupBySection = (\n  config: GroupBySectionConfiguration\n): React.FC<QueryEditorGroupBySectionProps> => {\n  return props => {\n    const styles = getStyles();\n\n    if (props.value.expressions.length === 0) {\n      return (\n        <QueryEditorSection label={props.label}>\n          <Button\n            variant=\"secondary\"\n            onClick={() => {\n              const expression: QueryEditorArrayExpression = {\n                ...props.value,\n                expressions: [config.defaultValue],\n              };\n              props.onChange(expression);\n            }}\n            icon=\"plus\"\n          />\n        </QueryEditorSection>\n      );\n    }\n\n    return (\n      <QueryEditorSection label={props.label}>\n        <div className={styles.container}>\n          <QueryEditorRepeater id=\"group-by\" onChange={props.onChange} value={props.value}>\n            {childProps => {\n              if (!isGroupBy(childProps.value)) {\n                return null;\n              }\n\n              const isFirst = childProps.index === 0;\n              const rowStyle = isFirst ? styles.row : styles.rowWithSpacing;\n\n              return (\n                <div className={rowStyle}>\n                  <QueryEditorGroupBy\n                    onChange={childProps.onChange}\n                    value={childProps.value}\n                    templateVariableOptions={props.templateVariableOptions}\n                    fields={props.fields}\n                    intervals={config.intervals}\n                  />\n                  <Button className={styles.spacing} variant=\"secondary\" onClick={childProps.onRemove} icon=\"minus\" />\n                  {isFirst && (\n                    <Button variant=\"secondary\" onClick={() => childProps.onAdd(config.defaultValue)} icon=\"plus\" />\n                  )}\n                </div>\n              );\n            }}\n          </QueryEditorRepeater>\n        </div>\n      </QueryEditorSection>\n    );\n  };\n};\n\nconst getStyles = stylesFactory(() => {\n  const row = css`\n    display: flex;\n    flex-direction: row;\n  `;\n\n  return {\n    container: css`\n      display: flex;\n      flex-direction: column;\n    `,\n    row: row,\n    rowWithSpacing: css`\n      ${row}\n      margin-top: 4px;\n    `,\n    spacing: css`\n      margin-right: 4px;\n    `,\n  };\n});\n","import { QueryEditorPropertyType, QueryEditorPropertyDefinition } from '../types';\n\nexport class QueryEditorIntervalBuilder {\n  private label: string;\n\n  constructor(private value: string, private intervals: QueryEditorPropertyDefinition[]) {\n    this.label = value;\n  }\n\n  withLabel(label: string) {\n    this.label = label;\n    return this;\n  }\n\n  add(): void {\n    this.intervals.push({\n      value: this.value,\n      label: this.label,\n      type: QueryEditorPropertyType.Interval,\n    });\n  }\n}\n","import React from 'react';\nimport { QueryEditorPropertyDefinition, QueryEditorPropertyType } from '../types';\nimport {\n  QueryEditorGroupBySection,\n  QueryEditorGroupBySectionProps,\n} from '../components/groupBy/QueryEditorGroupBySection';\nimport { QueryEditorIntervalBuilder } from './QueryEditorIntervalBuilder';\nimport { QueryEditorGroupByExpression, QueryEditorExpressionType } from '../expressions';\n\nexport class QueryEditorGroupByBuilder {\n  private intervals: QueryEditorPropertyDefinition[];\n\n  constructor() {\n    this.intervals = [];\n  }\n\n  withMultipleRows(value: boolean) {\n    return this;\n  }\n\n  withIntervals(intervals: (builder: (value: string) => QueryEditorIntervalBuilder) => void) {\n    intervals(value => new QueryEditorIntervalBuilder(value, this.intervals));\n    return this;\n  }\n\n  build(): React.FC<QueryEditorGroupBySectionProps> {\n    return QueryEditorGroupBySection({\n      intervals: this.intervals,\n      defaultValue: this.buildGroupByExpressions(),\n    });\n  }\n\n  private buildGroupByExpressions(): QueryEditorGroupByExpression {\n    return {\n      type: QueryEditorExpressionType.GroupBy,\n      property: {\n        name: '',\n        type: QueryEditorPropertyType.String,\n      },\n    };\n  }\n}\n","import {\n  buildFieldQueryEditorSection,\n  buildFilterQueryEditorSection,\n  buildReduceQueryEditorSection,\n  buildGroupByQueryEditorSection,\n} from '../editor';\n\nimport { QueryEditorPropertyType } from '../editor/types';\n\nexport const KustoFromEditorSection = buildFieldQueryEditorSection(fieldSection => fieldSection.build());\n\nexport const KustoWhereEditorSection = buildFilterQueryEditorSection(filterSection =>\n  filterSection\n    .withOperators(operator => {\n      operator('==')\n        .supportTypes([QueryEditorPropertyType.String, QueryEditorPropertyType.Number])\n        .withDescription('equal to')\n        .add();\n\n      operator('==')\n        .supportTypes([QueryEditorPropertyType.Boolean])\n        .withDescription('equal to')\n        .booleanValues(true)\n        .add();\n\n      operator('!=')\n        .supportTypes([QueryEditorPropertyType.String, QueryEditorPropertyType.Number])\n        .withDescription('not equal to')\n        .add();\n\n      operator('!=')\n        .supportTypes([QueryEditorPropertyType.Boolean])\n        .withDescription('not equal to')\n        .booleanValues(true)\n        .add();\n\n      operator('>')\n        .supportTypes([QueryEditorPropertyType.Number])\n        .withDescription('greater than')\n        .add();\n\n      operator('<')\n        .supportTypes([QueryEditorPropertyType.Number])\n        .withDescription('less than')\n        .add();\n\n      operator('=~')\n        .supportTypes([QueryEditorPropertyType.String])\n        .withDescription('equal to (case-insensitive)')\n        .add();\n\n      operator('!~')\n        .supportTypes([QueryEditorPropertyType.String])\n        .withDescription('not equal to (case-insensitive)')\n        .add();\n\n      operator('in')\n        .supportTypes([QueryEditorPropertyType.String, QueryEditorPropertyType.Number])\n        .withDescription('in (case-sensitive)')\n        .multipleValues(true)\n        .add();\n\n      operator('in~')\n        .supportTypes([QueryEditorPropertyType.String, QueryEditorPropertyType.Number])\n        .withDescription('in (case-insensitive)')\n        .add();\n\n      operator('!in')\n        .supportTypes([QueryEditorPropertyType.String, QueryEditorPropertyType.Number])\n        .withDescription('not in (case-sensitive)')\n        .multipleValues(true)\n        .add();\n\n      operator('!in~')\n        .supportTypes([QueryEditorPropertyType.String, QueryEditorPropertyType.Number])\n        .withDescription('not in (case-insensitive)')\n        .multipleValues(true)\n        .add();\n\n      operator('contains')\n        .supportTypes([QueryEditorPropertyType.String])\n        .withDescription('contains substring')\n        .multipleValues(false)\n        .add();\n\n      operator('!contains')\n        .supportTypes([QueryEditorPropertyType.String])\n        .withDescription('does not contain substring')\n        .multipleValues(false)\n        .add();\n\n      operator('contains_cs')\n        .supportTypes([QueryEditorPropertyType.String])\n        .withDescription('contains substring (case-sensitive)')\n        .multipleValues(false)\n        .add();\n\n      operator('!contains_cs')\n        .supportTypes([QueryEditorPropertyType.String])\n        .withDescription('does not contain substring (case-sensitive)')\n        .multipleValues(false)\n        .add();\n\n      operator('endswith')\n        .supportTypes([QueryEditorPropertyType.String])\n        .withDescription('ends with')\n        .multipleValues(false)\n        .add();\n\n      operator('!endswith')\n        .supportTypes([QueryEditorPropertyType.String])\n        .withDescription('does not end with')\n        .multipleValues(false)\n        .add();\n\n      operator('endswith_cs')\n        .supportTypes([QueryEditorPropertyType.String])\n        .withDescription('ends with (case-sensitive)')\n        .multipleValues(false)\n        .add();\n\n      operator('!endswith_cs')\n        .supportTypes([QueryEditorPropertyType.String])\n        .withDescription('does not end with (case-sensitive)')\n        .multipleValues(false)\n        .add();\n\n      operator('startswith')\n        .supportTypes([QueryEditorPropertyType.String])\n        .withDescription('starts with')\n        .multipleValues(false)\n        .add();\n\n      operator('!startsswith')\n        .supportTypes([QueryEditorPropertyType.String])\n        .withDescription('does not start with')\n        .multipleValues(false)\n        .add();\n\n      operator('startswith_cs')\n        .supportTypes([QueryEditorPropertyType.String])\n        .withDescription('starts with (case-sensitive)')\n        .multipleValues(false)\n        .add();\n\n      operator('!startswith_cs')\n        .supportTypes([QueryEditorPropertyType.String])\n        .withDescription('does not start with (case-sensitive)')\n        .multipleValues(false)\n        .add();\n\n      operator('matches regex')\n        .supportTypes([QueryEditorPropertyType.String])\n        .withDescription('regex string matching')\n        .multipleValues(false)\n        .add();\n    })\n    .withMultipleRows(true)\n    .build()\n);\n\nexport const KustoValueColumnEditorSection = buildReduceQueryEditorSection(reduceSection =>\n  reduceSection\n    .withFunctions(functions => {\n      functions('none')\n        .withLabel('None')\n        .add();\n\n      functions('sum')\n        .withLabel('Sum')\n        .add();\n\n      functions('avg')\n        .withLabel('Avg')\n        .add();\n\n      functions('count')\n        .withLabel('Count')\n        .add();\n\n      functions('max')\n        .withLabel('Max')\n        .add();\n\n      functions('min')\n        .withLabel('Min')\n        .add();\n\n      functions('percentile')\n        .withLabel('Percentile')\n        .withParameter('percentileParam', QueryEditorPropertyType.Number, 'percentile constant')\n        .add();\n    })\n    .withMultipleRows(true)\n    .build()\n);\n\nexport const KustoGroupByEditorSection = buildGroupByQueryEditorSection(groupBySection =>\n  groupBySection\n    .withIntervals(intervals => {\n      intervals('$__timeInterval')\n        .withLabel('auto')\n        .add();\n      intervals('1m')\n        .withLabel('1 minute')\n        .add();\n\n      intervals('5m')\n        .withLabel('5 minutes')\n        .add();\n\n      intervals('15m')\n        .withLabel('15 minutes')\n        .add();\n\n      intervals('30m')\n        .withLabel('30 minutes')\n        .add();\n\n      intervals('1h')\n        .withLabel('1 hour')\n        .add();\n\n      intervals('6h')\n        .withLabel('6 hours')\n        .add();\n\n      intervals('12h')\n        .withLabel('12 hours')\n        .add();\n\n      intervals('1d')\n        .withLabel('1 day')\n        .add();\n    })\n    .withMultipleRows(true)\n    .build()\n);\n","import React from 'react';\nimport { QueryEditorFilterSectionProps } from './components/filter/QueryEditorFilterSection';\nimport { QueryEditorFieldSectionProps } from './components/field/QueryEditorFieldSection';\nimport { QueryEditorFieldBuilder } from './builders/QueryEditorFieldBuilder';\nimport { QueryEditorFilterBuilder } from './builders/QueryEditorFilterBuilder';\nimport { QueryEditorReduceSectionProps } from './components/reduce/QueryEditorReduceSection';\nimport { QueryEditorReduceBuilder } from './builders/QueryEditorReduceBuilder';\nimport { QueryEditorGroupBySectionProps } from './components/groupBy/QueryEditorGroupBySection';\nimport { QueryEditorGroupByBuilder } from './builders/QueryEditorGroupByBuilder';\n\nexport const buildFieldQueryEditorSection = (\n  builder: (builder: QueryEditorFieldBuilder) => React.FC<QueryEditorFieldSectionProps>\n): React.FC<QueryEditorFieldSectionProps> => builder(new QueryEditorFieldBuilder());\n\nexport const buildFilterQueryEditorSection = (\n  builder: (builder: QueryEditorFilterBuilder) => React.FC<QueryEditorFilterSectionProps>\n): React.FC<QueryEditorFilterSectionProps> => builder(new QueryEditorFilterBuilder());\n\nexport const buildReduceQueryEditorSection = (\n  builder: (builder: QueryEditorReduceBuilder) => React.FC<QueryEditorReduceSectionProps>\n): React.FC<QueryEditorReduceSectionProps> => builder(new QueryEditorReduceBuilder());\n\nexport const buildGroupByQueryEditorSection = (\n  builder: (builder: QueryEditorGroupByBuilder) => React.FC<QueryEditorGroupBySectionProps>\n): React.FC<QueryEditorGroupBySectionProps> => builder(new QueryEditorGroupByBuilder());\n","import { AdxColumnSchema, AdxDatabaseSchema, AdxTableSchema } from '../types';\nimport { AdxDataSource } from '../datasource';\nimport { cache } from './cache';\n\nconst schemaKey = 'AdxSchemaResolver';\n\nexport class AdxSchemaResolver {\n  constructor(private datasource: AdxDataSource) {}\n\n  private createCacheKey(addition: string): string {\n    return `${schemaKey}.${this.datasource.meta.id}.${addition}`;\n  }\n\n  async getDatabases(): Promise<AdxDatabaseSchema[]> {\n    const cacheKey = this.createCacheKey('db');\n    const schema = await cache(cacheKey, () => this.datasource.getSchema());\n    return Object.keys(schema.Databases).map(key => schema.Databases[key]);\n  }\n\n  async getTablesForDatabase(databaseName: string): Promise<AdxTableSchema[]> {\n    const databases = await this.getDatabases();\n    const database = databases.find(db => db.Name === databaseName);\n\n    if (!database) {\n      return [];\n    }\n\n    return Object.keys(database.Tables).map(key => database.Tables[key]);\n  }\n\n  async getColumnsForTable(databaseName: string, tableName: string): Promise<AdxColumnSchema[]> {\n    const cacheKey = this.createCacheKey(`db.${databaseName}.${tableName}`);\n\n    return cache(cacheKey, async () => {\n      const tables = await this.getTablesForDatabase(databaseName);\n      const table = tables.find(t => t.Name === tableName);\n\n      if (!table) {\n        return [];\n      }\n\n      const dynamicColumns = table.OrderedColumns.filter(column => column.CslType === 'dynamic').map(\n        column => column.Name\n      );\n\n      const schemaByColumn = await this.datasource.getDynamicSchema(databaseName, tableName, dynamicColumns);\n\n      return table.OrderedColumns.reduce((columns: AdxColumnSchema[], column) => {\n        const schemaForDynamicColumn = schemaByColumn[column.Name];\n\n        if (!Array.isArray(schemaForDynamicColumn)) {\n          columns.push(column);\n          return columns;\n        }\n\n        Array.prototype.push.apply(columns, schemaForDynamicColumn);\n        return columns;\n      }, []);\n    });\n  }\n}\n","import { QueryExpression, AdxColumnSchema } from './types';\nimport { QueryEditorPropertyType } from 'editor/types';\nimport { getTemplateSrv, TemplateSrv } from '@grafana/runtime';\nimport {\n  isReduceExpression,\n  isFieldExpression,\n  isFieldAndOperator,\n  isMultiOperator,\n  isSingleOperator,\n  isGroupBy,\n  isDateGroupBy,\n  isAndExpression,\n  isOrExpression,\n} from './editor/guards';\nimport { QueryEditorExpression, QueryEditorOperatorExpression, QueryEditorArrayExpression } from './editor/expressions';\nimport { columnsToDefinition } from 'schema/mapper';\n\nexport class KustoExpressionParser {\n  templateSrv: TemplateSrv;\n\n  constructor(private limit: number = 10000) {\n    this.templateSrv = getTemplateSrv();\n  }\n\n  fromTable(expression?: QueryEditorExpression, interpolate = false): string {\n    if (expression && isFieldExpression(expression)) {\n      if (interpolate) {\n        return this.templateSrv.replace(expression.property.name);\n      } else {\n        return expression.property.name;\n      }\n    }\n    return '';\n  }\n\n  query(sections: QueryExpression | undefined, columns: AdxColumnSchema[] | undefined): string {\n    if (!sections || !columns) {\n      return '';\n    }\n\n    const { from, where, reduce, groupBy } = sections;\n    const table = this.fromTable(from);\n\n    if (!table) {\n      return '';\n    }\n\n    const definitionColumns = columnsToDefinition(columns);\n    const defaultTimeColumn = definitionColumns?.find(col => col.type === QueryEditorPropertyType.DateTime)?.value;\n    const parts: string[] = [table];\n\n    if (reduce && groupBy && this.isAggregated(groupBy)) {\n      this.appendTimeFilter(groupBy, defaultTimeColumn, parts);\n    } else if (defaultTimeColumn) {\n      parts.push(`where $__timeFilter(${defaultTimeColumn})`);\n    }\n\n    if (where) {\n      this.appendWhere(where, parts);\n    }\n\n    if (reduce && groupBy && this.isAggregated(groupBy)) {\n      this.appendSummarize(reduce, groupBy, columns, parts);\n    } else if (reduce) {\n      this.appendProject(reduce, defaultTimeColumn, columns, parts);\n    }\n\n    parts.push(`take ${this.limit}`);\n\n    return parts.join('\\n| ');\n  }\n\n  appendTimeFilter(\n    groupByExpression: QueryEditorArrayExpression,\n    defaultTimeColumn: string | undefined,\n    parts: string[]\n  ) {\n    let dateTimeField = defaultTimeColumn;\n\n    if (groupByExpression) {\n      dateTimeField = this.getGroupByFields(groupByExpression).dateTimeField || defaultTimeColumn;\n    }\n\n    if (dateTimeField) {\n      parts.push(`where $__timeFilter(${dateTimeField})`);\n    }\n  }\n\n  appendProject(\n    expression: QueryEditorArrayExpression,\n    defaultTimeColumn: string | undefined,\n    columns: AdxColumnSchema[],\n    parts: string[]\n  ) {\n    let project = 'project ';\n    let timeCol = defaultTimeColumn;\n\n    const fields: string[] = [];\n\n    for (const exp of expression.expressions) {\n      if (isReduceExpression(exp) && exp.property?.name) {\n        if (exp.property.type === QueryEditorPropertyType.DateTime) {\n          timeCol = exp.property.name;\n        } else {\n          fields.push(exp.property.name);\n        }\n      }\n    }\n\n    let toProject: string[] = [];\n\n    if (timeCol) {\n      toProject.push(timeCol);\n    }\n\n    if (fields.length > 0) {\n      project += toProject\n        .concat(fields)\n        .map(field => this.castIfDynamic(field, columns))\n        .join(', ');\n\n      parts.push(project);\n    }\n\n    if (timeCol) {\n      const orderBy = `order by ${this.castIfDynamic(timeCol, columns)} asc`;\n      parts.push(orderBy);\n    }\n  }\n\n  private createWhere(expression: QueryEditorOperatorExpression): string | undefined {\n    let where = '';\n\n    if (!expression.property) {\n      return;\n    }\n\n    where += `${expression.property.name} `;\n\n    if (!expression.operator) {\n      return where;\n    }\n\n    // we should skip having the whole operator object\n    // and only have the value here directly on the operator.\n    where += `${expression.operator.name} `;\n\n    // we should probably break this kind of code out into smaller function that\n    // can be reused in the parser.\n    if (isMultiOperator(expression.operator)) {\n      where += '(';\n      where += expression.operator.value.map(this.processMultiValueFilter.bind(this)).join(', ');\n      where += ')';\n    } else if (isSingleOperator(expression.operator)) {\n      if (\n        expression.property.type === QueryEditorPropertyType.String &&\n        !this.isQuotedString(expression.operator.value)\n      ) {\n        where += `'${expression.operator.value}'`;\n      } else {\n        where += expression.operator.value;\n      }\n    }\n\n    return where;\n  }\n\n  private processMultiValueFilter(value: string) {\n    if (this.isVariable(value)) {\n      return value;\n    } else {\n      return `'${value}'`;\n    }\n  }\n\n  private appendWhere(expression: QueryEditorExpression, parts: string[]) {\n    if (isAndExpression(expression)) {\n      return expression.expressions.map(and => this.appendWhere(and, parts));\n    }\n\n    if (isOrExpression(expression)) {\n      const orParts = expression.expressions\n        .map(orExpression => {\n          if (!isFieldAndOperator(orExpression)) {\n            return;\n          }\n          return this.createWhere(orExpression);\n        })\n        .filter(part => !!part);\n\n      if (orParts.length > 0) {\n        parts.push(`where ${orParts.join(' or ')}`);\n      }\n\n      return;\n    }\n\n    if (isFieldAndOperator(expression)) {\n      const statement = this.createWhere(expression);\n\n      if (statement) {\n        parts.push(`where ${statement}`);\n      }\n\n      return;\n    }\n  }\n\n  private appendSummarize(\n    reduceExpression: QueryEditorArrayExpression,\n    groupByExpression: QueryEditorArrayExpression,\n    columns: AdxColumnSchema[],\n    parts: string[]\n  ) {\n    let summarize = 'summarize ';\n    let reduceExpressions: string[] = [];\n\n    for (const exp of reduceExpression.expressions) {\n      if (isReduceExpression(exp) && exp?.reduce?.name !== 'none' && exp?.property?.name) {\n        const field = this.castIfDynamic(exp.property.name, columns);\n\n        if (exp?.parameters && exp?.parameters.length > 0) {\n          reduceExpressions.push(`${exp.reduce.name}(${field}, ${exp.parameters.map(p => p.value).join(', ')})`);\n        } else {\n          reduceExpressions.push(`${exp.reduce.name}(${field})`);\n        }\n      }\n    }\n\n    summarize += reduceExpressions.join(', ');\n\n    const fields = this.getGroupByFields(groupByExpression);\n    if (fields.dateTimeField) {\n      summarize += ` by bin(${this.castIfDynamic(fields.dateTimeField, columns)}, ${fields.interval})`;\n    }\n    if (fields.groupByFields.length > 0) {\n      if (fields.dateTimeField) {\n        summarize += `,`;\n      } else {\n        summarize += ' by ';\n      }\n      summarize += fields.groupByFields.map(field => this.castIfDynamic(field, columns)).join(', ');\n    }\n\n    parts.push(summarize);\n\n    if (fields.dateTimeField) {\n      const orderBy = `order by ${this.castIfDynamic(fields.dateTimeField, columns)} asc`;\n      parts.push(orderBy);\n    }\n  }\n\n  private castIfDynamic(column: string, columns: AdxColumnSchema[]): string {\n    if (!column || column.indexOf('.') < 0) {\n      return column;\n    }\n\n    const columnSchema = columns.find(c => c.Name === column);\n    const columnType = columnSchema?.CslType;\n\n    if (!columnType) {\n      return column;\n    }\n\n    const parts = column.split('.');\n\n    return parts.reduce((result: string, part, index) => {\n      if (!result) {\n        return `todynamic(${part})`;\n      }\n\n      if (index + 1 === parts.length) {\n        return `to${columnType}(${result}.${part})`;\n      }\n\n      return `todynamic(${result}.${part})`;\n    }, '');\n  }\n\n  private getGroupByFields(groupByExpression: QueryEditorArrayExpression): GroupByFields {\n    let dateTimeField = '';\n    let interval = '';\n    let groupByFields: string[] = [];\n\n    for (const exp of groupByExpression.expressions) {\n      if (isGroupBy(exp) && isDateGroupBy(exp) && exp.interval) {\n        dateTimeField = exp.property.name;\n        interval = exp.interval.name;\n      } else if (isGroupBy(exp) && !isDateGroupBy(exp) && exp.property && exp.property.name) {\n        groupByFields.push(exp.property.name);\n      }\n    }\n\n    return { dateTimeField, interval, groupByFields };\n  }\n\n  private isAggregated(exp: QueryEditorArrayExpression): boolean {\n    return exp.expressions.length > 0;\n  }\n\n  private isQuotedString(value: string): boolean {\n    return (\n      (value[0] === \"'\" || value[0] === '\"') && (value[value.length - 1] === \"'\" || value[value.length - 1] === '\"')\n    );\n  }\n\n  private isVariable(value: string): boolean {\n    const variables = this.templateSrv.getVariables();\n    for (const variable of variables) {\n      if ('$' + variable.name === value) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n}\n\ninterface GroupByFields {\n  dateTimeField: string;\n  interval: string;\n  groupByFields: string[];\n}\n","import { KustoQuery, defaultQuery, AdxColumnSchema } from 'types';\nimport { DataQueryRequest } from '@grafana/data';\nimport { AdxDataSource } from '../datasource';\n\nexport class AdxAutoComplete {\n  constructor(\n    private datasource: AdxDataSource,\n    private columnSchema: AdxColumnSchema[] = [],\n    private database?: string,\n    private table?: string\n  ) {}\n\n  async search(searchTerm?: string, column?: string): Promise<string[]> {\n    if (!searchTerm || !column || !this.table || !this.database) {\n      return [];\n    }\n\n    const queryParts: string[] = [];\n\n    queryParts.push(this.table);\n    queryParts.push(`where ${column} contains \"${searchTerm}\"`);\n    queryParts.push(`distinct ${this.castIfDynamic(column, this.columnSchema)}`);\n    queryParts.push(`take 251`);\n\n    const kql = queryParts.join('\\n| ');\n\n    const query: KustoQuery = {\n      ...defaultQuery,\n      refId: `adx-${kql}`,\n      database: this.database,\n      rawMode: true,\n      query: kql,\n      resultFormat: 'table',\n      querySource: 'autocomplete',\n    };\n\n    const response = await this.datasource\n      .query({\n        targets: [query],\n      } as DataQueryRequest<KustoQuery>)\n      .toPromise();\n\n    if (!Array.isArray(response?.data) || response.data.length === 0) {\n      return [];\n    }\n    return response.data[0].fields[0].values.toArray();\n  }\n\n  private castIfDynamic(column: string, columns: AdxColumnSchema[]): string {\n    if (!column || column.indexOf('.') < 0) {\n      return column;\n    }\n\n    const columnSchema = columns.find(c => c.Name === column);\n    const columnType = columnSchema?.CslType;\n\n    if (!columnType) {\n      return column;\n    }\n\n    const parts = column.split('.');\n\n    return parts.reduce((result: string, part, index) => {\n      if (!result) {\n        return `todynamic(${part})`;\n      }\n\n      if (index + 1 === parts.length) {\n        return `to${columnType}(${result}.${part})`;\n      }\n\n      return `todynamic(${result}.${part})`;\n    }, '');\n  }\n}\n","import React from 'react';\nimport { css } from 'emotion';\nimport { Icon, stylesFactory, useTheme } from '@grafana/ui';\nimport { GrafanaTheme } from '@grafana/data';\n\nexport const SchemaLoading: React.FC<{}> = props => {\n  const theme = useTheme();\n  const styles = getStyles(theme);\n\n  return (\n    <div className={styles.container}>\n      <div className={styles.icon}>\n        <Icon className=\"spin-clockwise\" name=\"sync\" />\n      </div>\n      <span>One moment, your schema is loading ...</span>\n    </div>\n  );\n};\n\ninterface ErrorProps {\n  message: string;\n}\n\nexport const SchemaError: React.FC<ErrorProps> = props => {\n  const theme = useTheme();\n  const styles = getStyles(theme);\n\n  return (\n    <div className={styles.container}>\n      <div className={styles.icon}>\n        <Icon name=\"exclamation-triangle\" className={styles.error} />\n      </div>\n      <span className={styles.error}>{props.message}</span>\n    </div>\n  );\n};\n\nexport const SchemaWarning: React.FC<ErrorProps> = props => {\n  const theme = useTheme();\n  const styles = getStyles(theme);\n\n  return (\n    <div className={styles.container}>\n      <div className={styles.icon}>\n        <Icon name=\"exclamation-triangle\" className={styles.warning} />\n      </div>\n      <span className={styles.warning}>{props.message}</span>\n    </div>\n  );\n};\n\nconst getStyles = stylesFactory((theme: GrafanaTheme) => {\n  return {\n    container: css`\n      margin-top: 10px;\n      display: flex;\n      flex-direction: row;\n    `,\n    icon: css`\n      margin-right: 4px;\n    `,\n    error: css`\n      color: ${theme.colors.formInputBorderInvalid};\n    `,\n    warning: css`\n      color: ${theme.palette.yellow};\n    `,\n  };\n});\n","import React, { useMemo, useCallback } from 'react';\nimport { useAsync } from 'react-use';\nimport { css } from 'emotion';\nimport { KustoQuery, AdxSchema, AdxColumnSchema, defaultQuery } from '../types';\nimport { tableToDefinition, columnsToDefinition } from '../schema/mapper';\nimport {\n  QueryEditorExpressionType,\n  QueryEditorPropertyExpression,\n  QueryEditorExpression,\n  QueryEditorArrayExpression,\n} from 'editor/expressions';\nimport { QueryEditorPropertyDefinition, QueryEditorPropertyType } from '../editor/types';\nimport {\n  KustoFromEditorSection,\n  KustoWhereEditorSection,\n  KustoValueColumnEditorSection,\n  KustoGroupByEditorSection,\n} from './VisualQueryEditorSections';\nimport { definitionToProperty } from '../editor/components/field/QueryEditorField';\nimport { isFieldExpression } from '../editor/guards';\nimport { AdxDataSource } from '../datasource';\nimport { AdxSchemaResolver } from '../schema/AdxSchemaResolver';\nimport { QueryEditorResultFormat, selectResultFormat } from '../components/QueryEditorResultFormat';\nimport { KustoExpressionParser } from '../KustoExpressionParser';\nimport { TextArea, stylesFactory } from '@grafana/ui';\nimport { SelectableValue } from '@grafana/data';\nimport { AdxAutoComplete } from '../schema/AdxAutoComplete';\nimport { SchemaLoading, SchemaError, SchemaWarning } from '../components/SchemaMessages';\n\ninterface Props {\n  database: string;\n  query: KustoQuery;\n  onChangeQuery: (query: KustoQuery) => void;\n  schema?: AdxSchema;\n  datasource: AdxDataSource;\n  templateVariableOptions: SelectableValue<string>;\n}\n\nconst kustoExpressionParser = new KustoExpressionParser();\n\nexport const VisualQueryEditor: React.FC<Props> = props => {\n  const { query, database, datasource, schema } = props;\n\n  const resultFormat = selectResultFormat(query.resultFormat);\n  const tables = useTableOptions(schema, database);\n  const table = useSelectedTable(tables, query);\n  const tableSchema = useAsync(async () => {\n    if (!table || !table.property) {\n      return [];\n    }\n    return getTableSchema(datasource, database, table);\n  }, [datasource.id, database, table]);\n\n  const onAutoComplete = useCallback(\n    async (searchTerm?: string, column?: string) => {\n      const tableName = table?.property.name;\n      const autoComplete = new AdxAutoComplete(datasource, tableSchema.value, database, tableName);\n      const values = await autoComplete.search(searchTerm, column);\n      return values.map(value => ({ value, label: value }));\n    },\n    [datasource, database, table, tableSchema.value]\n  );\n\n  const columns = useColumnOptions(tableSchema.value);\n  const groupable = useGroupableColumns(columns);\n\n  const onChangeTable = async (expression: QueryEditorExpression) => {\n    if (!isFieldExpression(expression) || !table) {\n      return;\n    }\n\n    const columns = await getTableSchema(datasource, database, expression);\n\n    const next = {\n      ...defaultQuery.expression,\n      from: expression,\n    };\n\n    props.onChangeQuery({\n      ...props.query,\n      resultFormat: resultFormat,\n      database: database,\n      expression: next,\n      query: kustoExpressionParser.query(next, columns),\n    });\n  };\n\n  const onWhereChange = useCallback(\n    (expression: QueryEditorArrayExpression) => {\n      const next = {\n        ...props.query.expression,\n        from: table,\n        where: expression,\n      };\n\n      props.onChangeQuery({\n        ...props.query,\n        resultFormat: resultFormat,\n        database: database,\n        expression: next,\n        query: kustoExpressionParser.query(next, tableSchema.value),\n      });\n    },\n    [props.onChangeQuery, props.query, tableSchema.value, resultFormat]\n  );\n\n  const onReduceChange = useCallback(\n    (expression: QueryEditorArrayExpression) => {\n      const next = {\n        ...props.query.expression,\n        reduce: expression,\n      };\n\n      props.onChangeQuery({\n        ...props.query,\n        resultFormat: resultFormat,\n        expression: next,\n        query: kustoExpressionParser.query(next, tableSchema.value),\n      });\n    },\n    [props.onChangeQuery, props.query, tableSchema.value, resultFormat]\n  );\n\n  const onGroupByChange = useCallback(\n    (expression: QueryEditorArrayExpression) => {\n      const next = {\n        ...props.query.expression,\n        groupBy: expression,\n      };\n\n      props.onChangeQuery({\n        ...props.query,\n        resultFormat: resultFormat,\n        expression: next,\n        query: kustoExpressionParser.query(next, tableSchema.value),\n      });\n    },\n    [props.onChangeQuery, props.query, tableSchema.value, resultFormat]\n  );\n\n  const onChangeResultFormat = useCallback(\n    (format: string) => {\n      props.onChangeQuery({\n        ...query,\n        resultFormat: format,\n      });\n    },\n    [props.onChangeQuery]\n  );\n\n  if (tableSchema.loading) {\n    return (\n      <>\n        <KustoFromEditorSection\n          templateVariableOptions={props.templateVariableOptions}\n          label=\"From\"\n          value={table}\n          fields={tables}\n          onChange={onChangeTable}\n        />\n        <SchemaLoading />\n      </>\n    );\n  }\n\n  if (tableSchema.error) {\n    return (\n      <>\n        <KustoFromEditorSection\n          templateVariableOptions={props.templateVariableOptions}\n          label=\"From\"\n          value={table}\n          fields={tables}\n          onChange={onChangeTable}\n        />\n        <SchemaError message={`Could not load table schema: ${tableSchema.error?.message}`} />\n      </>\n    );\n  }\n\n  if (tableSchema.value?.length === 0) {\n    return (\n      <>\n        <KustoFromEditorSection\n          templateVariableOptions={props.templateVariableOptions}\n          label=\"From\"\n          value={table}\n          fields={tables}\n          onChange={onChangeTable}\n        />\n        <SchemaWarning message=\"Table schema loaded successfully but without any columns\" />\n      </>\n    );\n  }\n\n  const styles = getStyles();\n\n  return (\n    <>\n      <KustoFromEditorSection\n        templateVariableOptions={props.templateVariableOptions}\n        label=\"From\"\n        value={table}\n        fields={tables}\n        onChange={onChangeTable}\n      >\n        <QueryEditorResultFormat\n          format={resultFormat}\n          includeAdxTimeFormat={false}\n          onChangeFormat={onChangeResultFormat}\n        />\n      </KustoFromEditorSection>\n      <KustoWhereEditorSection\n        templateVariableOptions={props.templateVariableOptions}\n        label=\"Where (filter)\"\n        value={query.expression?.where ?? defaultQuery.expression?.where}\n        fields={columns}\n        onChange={onWhereChange}\n        getSuggestions={onAutoComplete}\n      />\n      <KustoValueColumnEditorSection\n        templateVariableOptions={props.templateVariableOptions}\n        label=\"Value columns\"\n        value={query.expression?.reduce ?? defaultQuery.expression?.reduce}\n        fields={columns}\n        onChange={onReduceChange}\n        getSuggestions={onAutoComplete}\n      />\n      <KustoGroupByEditorSection\n        templateVariableOptions={props.templateVariableOptions}\n        label=\"Group by (summarize)\"\n        value={query.expression?.groupBy ?? defaultQuery.expression?.groupBy}\n        fields={groupable}\n        onChange={onGroupByChange}\n        getSuggestions={onAutoComplete}\n      />\n      <div className={styles.query}>\n        <TextArea cols={80} rows={8} value={props.query.query} disabled={true} />\n      </div>\n    </>\n  );\n};\n\nconst getStyles = stylesFactory(() => {\n  return {\n    query: css`\n      margin-top: 12px;\n    `,\n  };\n});\n\nconst useGroupableColumns = (columns: QueryEditorPropertyDefinition[]): QueryEditorPropertyDefinition[] => {\n  return useMemo(() => {\n    return columns.filter(c => c.type === QueryEditorPropertyType.DateTime || QueryEditorPropertyType.String);\n  }, [columns]);\n};\n\nconst useColumnOptions = (tableSchema?: AdxColumnSchema[]): QueryEditorPropertyDefinition[] => {\n  return useMemo(() => {\n    if (!tableSchema) {\n      return [];\n    }\n    return columnsToDefinition(tableSchema);\n  }, [tableSchema]);\n};\n\nconst useSelectedTable = (\n  options: QueryEditorPropertyDefinition[],\n  query: KustoQuery\n): QueryEditorPropertyExpression | undefined => {\n  return useMemo(() => {\n    const from = query.expression?.from?.property.name;\n    const selected = options.find(option => option.value === from);\n\n    if (selected) {\n      return {\n        type: QueryEditorExpressionType.Property,\n        property: definitionToProperty(selected),\n      };\n    }\n\n    if (options.length > 0) {\n      return {\n        type: QueryEditorExpressionType.Property,\n        property: definitionToProperty(options[0]),\n      };\n    }\n\n    return;\n  }, [options, query.expression?.from]);\n};\n\nconst useTableOptions = (schema: AdxSchema | undefined, database: string): QueryEditorPropertyDefinition[] => {\n  return useMemo(() => {\n    if (!schema || !schema.Databases) {\n      return [];\n    }\n\n    const databaseSchema = schema.Databases[database];\n\n    if (!databaseSchema || !databaseSchema.Tables) {\n      return [];\n    }\n\n    const tables: QueryEditorPropertyDefinition[] = [];\n\n    for (const name of Object.keys(databaseSchema.Tables)) {\n      const table = databaseSchema.Tables[name];\n      tables.push(tableToDefinition(table));\n    }\n\n    return tables;\n  }, [database, schema]);\n};\n\nasync function getTableSchema(datasource: AdxDataSource, database: string, table: QueryEditorPropertyExpression) {\n  const schemaResolver = new AdxSchemaResolver(datasource);\n  return await schemaResolver.getColumnsForTable(database, table.property.name);\n}\n","import React, { useState, useCallback } from 'react';\nimport { css } from 'emotion';\nimport { Select, Button, stylesFactory, ConfirmModal } from '@grafana/ui';\nimport { SelectableValue } from '@grafana/data';\nimport { QueryEditorSection } from '../editor/components/QueryEditorSection';\n\ntype EditorMode = 'raw' | 'visual';\n\ninterface Props {\n  database: string;\n  databases: Array<SelectableValue<string>>;\n  editorMode: EditorMode;\n  dirty: boolean;\n  onChangeDatabase: (databaseName: string) => void;\n  onRunQuery: () => void;\n  onToggleEditorMode: () => void;\n}\n\nexport const QueryEditorToolbar: React.FC<Props> = props => {\n  const [showConfirm, setShowConfirm] = useState(false);\n  const onToggleMode = useCallback(() => {\n    if (!props.dirty || props.editorMode === 'visual') {\n      props.onToggleEditorMode();\n      return;\n    }\n    setShowConfirm(true);\n  }, [setShowConfirm, props.onToggleEditorMode, props.dirty, props.editorMode]);\n\n  const styles = getStyles();\n\n  return (\n    <QueryEditorSection label=\"Database\">\n      <Select\n        width={30}\n        options={props.databases}\n        placeholder=\"Select database\"\n        value={props.database}\n        onChange={selected => {\n          if (!selected || !selected.value) {\n            return;\n          }\n          props.onChangeDatabase(selected.value);\n        }}\n      />\n      {props.editorMode === 'raw' && (\n        <>\n          <div className={styles.spacing} />\n          <label className=\"gf-form-label\">(Run Query: Shift+Enter, Trigger Suggestion: Ctrl+Space)</label>\n        </>\n      )}\n      <div className=\"gf-form gf-form--grow\">\n        <div className=\"gf-form-label--grow\" />\n      </div>\n      <Button variant=\"secondary\" onClick={onToggleMode}>\n        {props.editorMode === 'visual' ? 'Edit KQL' : 'Switch to builder'}\n      </Button>\n      <div className={styles.spacing} />\n      <Button variant={props.dirty ? 'primary' : 'secondary'} onClick={props.onRunQuery}>\n        Run Query\n      </Button>\n      <ConfirmModal\n        isOpen={showConfirm}\n        title=\"Are you sure?\"\n        body=\"You might loose manual changes done to the query if you go back to the visual builder.\"\n        confirmText=\"Yes, I am sure.\"\n        dismissText=\"No, continue edit query manually.\"\n        icon=\"exclamation-triangle\"\n        onConfirm={() => {\n          setShowConfirm(false);\n          props.onToggleEditorMode();\n        }}\n        onDismiss={() => setShowConfirm(false)}\n      />\n    </QueryEditorSection>\n  );\n};\n\nconst getStyles = stylesFactory(() => {\n  return {\n    spacing: css`\n      margin-right: 4px;\n    `,\n  };\n});\n","import _ from 'lodash';\nimport { QueryExpression, defaultQuery } from 'types';\nimport {\n  QueryEditorExpressionType,\n  QueryEditorOperatorExpression,\n  QueryEditorExpression,\n  QueryEditorArrayExpression,\n  QueryEditorPropertyExpression,\n  QueryEditorReduceExpression,\n  QueryEditorGroupByExpression,\n} from 'editor/expressions';\nimport { QueryEditorPropertyType, QueryEditorProperty } from 'editor/types';\n\nexport const migrateExpression = (version: string | undefined, expression: any): QueryExpression => {\n  if (looksLikeV2(expression)) {\n    return migrateV2ToV3(expression);\n  }\n  return expression ?? defaultQuery.expression;\n};\n\nexport const looksLikeV2 = (expression: any): boolean => {\n  return typeof expression?.from?.expression?.value === 'string';\n};\n\nconst migrateV2ToV3 = (expression: any): QueryExpression => {\n  if (!expression) {\n    return defaultQuery.expression;\n  }\n\n  const migrated: QueryExpression = {\n    ...defaultQuery.expression,\n  };\n\n  if (typeof expression?.from?.expression?.value === 'string') {\n    migrated.from = migrateV2PropertyExpression(expression?.from?.expression);\n  }\n\n  if (Array.isArray(expression?.where?.expression?.expressions)) {\n    migrated.where = {\n      type: QueryEditorExpressionType.And,\n      expressions: expression?.where?.expression?.expressions\n        .map(migrateV2Expression)\n        .filter(exp => !!exp)\n        .map(exp => {\n          return {\n            type: QueryEditorExpressionType.Or,\n            expressions: [exp],\n          };\n        }) as QueryEditorExpression[],\n    };\n  }\n\n  if (Array.isArray(expression?.reduce?.expression?.expressions)) {\n    migrated.reduce = migrateV2Array(expression?.reduce?.expression?.expressions);\n  }\n\n  if (Array.isArray(expression?.groupBy?.expression?.expressions)) {\n    migrated.groupBy = migrateV2Array(expression?.groupBy?.expression?.expressions);\n  }\n\n  return migrated;\n};\n\nconst migrateV2Array = (expressions: any[]): QueryEditorArrayExpression => {\n  if (!Array.isArray(expressions)) {\n    return {\n      type: QueryEditorExpressionType.And,\n      expressions: [],\n    };\n  }\n\n  return {\n    type: QueryEditorExpressionType.And,\n    expressions: expressions.map(migrateV2Expression).filter(exp => !!exp) as QueryEditorExpression[],\n  };\n};\n\nconst migrateV2Expression = (expression: any): QueryEditorExpression | undefined => {\n  switch (expression?.type) {\n    case 'fieldAndOperator':\n      return migrateV2OperatorExpression(expression);\n    case 'field':\n      return migrateV2PropertyExpression(expression);\n    case 'reduce':\n      return migrateV2ReduceExpression(expression);\n    case 'groupBy':\n      return migrateV2GroupByExpression(expression);\n    default:\n      return;\n  }\n};\n\nconst migrateV2GroupByExpression = (expression: any): QueryEditorGroupByExpression | undefined => {\n  if (expression?.type !== 'groupBy') {\n    return;\n  }\n\n  if (typeof expression?.field !== 'object') {\n    return;\n  }\n\n  if (typeof expression?.interval !== 'object') {\n    return {\n      type: QueryEditorExpressionType.GroupBy,\n      property: migrateV2Property(expression?.field),\n    };\n  }\n\n  return {\n    type: QueryEditorExpressionType.GroupBy,\n    property: migrateV2Property(expression?.field),\n    interval: migrateV2Property(expression?.interval),\n  };\n};\n\nconst migrateV2ReduceExpression = (expression: any): QueryEditorReduceExpression | undefined => {\n  if (expression?.type !== 'reduce') {\n    return;\n  }\n\n  if (typeof expression?.field !== 'object') {\n    return;\n  }\n\n  if (Array.isArray(expression?.parameters)) {\n    return {\n      type: QueryEditorExpressionType.Reduce,\n      property: migrateV2Property(expression?.field),\n      reduce: migrateV2Property(expression?.reduce),\n      parameters: expression.parameters,\n    };\n  }\n\n  return {\n    type: QueryEditorExpressionType.Reduce,\n    property: migrateV2Property(expression?.field),\n    reduce: migrateV2Property(expression?.reduce),\n  };\n};\n\nconst migrateV2PropertyExpression = (expression: any): QueryEditorPropertyExpression | undefined => {\n  if (expression?.type !== 'field') {\n    return;\n  }\n\n  if (typeof expression?.value !== 'string') {\n    return;\n  }\n\n  return {\n    type: QueryEditorExpressionType.Property,\n    property: migrateV2Property(expression),\n  };\n};\n\nconst migrateV2OperatorExpression = (expression: any): QueryEditorOperatorExpression | undefined => {\n  if (typeof expression?.field?.value !== 'string') {\n    return;\n  }\n\n  if (typeof expression?.operator?.operator?.value !== 'string') {\n    return;\n  }\n\n  return {\n    type: QueryEditorExpressionType.Operator,\n    property: migrateV2Property(expression?.field),\n    operator: {\n      name: expression?.operator?.operator?.value,\n      value: expression?.operator?.value ?? expression?.operator?.values,\n    },\n  };\n};\n\nconst migrateV2Property = (property: any): QueryEditorProperty => {\n  return {\n    type: migrateV2PropertType(property.fieldType),\n    name: property.value,\n  };\n};\n\nconst migrateV2PropertType = (type: any): QueryEditorPropertyType => {\n  switch (type) {\n    case 'boolean':\n      return QueryEditorPropertyType.Boolean;\n    case 'dateTime':\n      return QueryEditorPropertyType.DateTime;\n    case 'function':\n      return QueryEditorPropertyType.Function;\n    case 'number':\n      return QueryEditorPropertyType.Number;\n    case 'interval':\n      return QueryEditorPropertyType.Interval;\n    default:\n      return QueryEditorPropertyType.String;\n  }\n};\n","import { KustoQuery, defaultQuery } from 'types';\nimport { looksLikeV2, migrateExpression } from './expression';\n\nexport const migrateQuery = (query: KustoQuery): KustoQuery => {\n  return {\n    ...defaultQuery,\n    ...query,\n    rawMode: isRawMode(query),\n    pluginVersion: defaultQuery.pluginVersion,\n    expression: migrateExpression(defaultQuery.pluginVersion, query.expression),\n  };\n};\n\nexport const needsToBeMigrated = (query: KustoQuery): boolean => {\n  if (!query) {\n    return false;\n  }\n\n  if (!query.pluginVersion) {\n    return true;\n  }\n\n  if (!query.querySource) {\n    return true;\n  }\n\n  if (looksLikeV2(query.expression)) {\n    return true;\n  }\n\n  return false;\n};\n\nfunction isRawMode(query: KustoQuery): boolean {\n  if (query.rawMode === undefined && query.query && !query.expression?.from) {\n    return true;\n  }\n  return query.rawMode || false;\n}\n","import React, { useMemo, useCallback, useEffect } from 'react';\nimport { useAsync } from 'react-use';\nimport { QueryEditorProps, PanelData } from '@grafana/data';\n// Hack for issue: https://github.com/grafana/grafana/issues/26512\nimport {} from '@emotion/core';\nimport { AdxDataSource } from './datasource';\nimport { KustoQuery, AdxDataSourceOptions, AdxSchema } from 'types';\nimport { QueryEditorPropertyDefinition } from './editor/types';\nimport { RawQueryEditor } from './components/RawQueryEditor';\nimport { databaseToDefinition } from './schema/mapper';\nimport { VisualQueryEditor } from './components/VisualQueryEditor';\nimport { QueryEditorToolbar } from './components/QueryEditorToolbar';\nimport { SchemaLoading } from 'components/SchemaMessages';\nimport { needsToBeMigrated, migrateQuery } from 'migrations/query';\n\ntype Props = QueryEditorProps<AdxDataSource, KustoQuery, AdxDataSourceOptions>;\n\nexport const QueryEditor: React.FC<Props> = props => {\n  const { datasource, query } = props;\n  const executedQuery = useExecutedQuery(props.data);\n  const executedQueryError = useExecutedQueryError(props.data);\n  const dirty = useDirty(props.query.query, executedQuery);\n  const schema = useAsync(() => datasource.getSchema(), [datasource.id]);\n  const databases = useDatabaseOptions(schema.value);\n  const database = useSelectedDatabase(databases, query);\n  const templateVariables = useTemplateVariables(datasource);\n  const rawMode = isRawMode(props);\n\n  useEffect(() => {\n    if (needsToBeMigrated(query)) {\n      props.onChange(migrateQuery(query));\n      props.onRunQuery();\n    }\n  }, []);\n\n  const onChangeDatabase = useCallback(\n    (database: string) => {\n      props.onChange({\n        ...props.query,\n        database,\n      });\n    },\n    [props.onChange, props.query]\n  );\n\n  const onToggleEditorMode = useCallback(() => {\n    props.onChange({\n      ...props.query,\n      rawMode: !rawMode,\n      querySource: rawMode ? 'visual' : 'raw',\n    });\n  }, [props.onChange, props.query]);\n\n  if (schema.loading) {\n    return <SchemaLoading />;\n  }\n\n  if (schema.error) {\n    return (\n      <div className=\"gf-form\">\n        <pre className=\"gf-form-pre alert alert-error\">Could not load datasource schema: {schema.error}</pre>\n      </div>\n    );\n  }\n\n  if (databases.length === 0) {\n    return (\n      <div className=\"gf-form\">\n        <pre className=\"gf-form-pre alert alert-warning\">\n          Datasource schema loaded but without any databases and tables, please try again..\n        </pre>\n      </div>\n    );\n  }\n\n  const editorMode = rawMode ? 'raw' : 'visual';\n\n  return (\n    <>\n      {executedQueryError && (\n        <div className=\"gf-form\">\n          <pre className=\"gf-form-pre alert alert-warning\">Failed to execute query: {executedQueryError}</pre>\n        </div>\n      )}\n      <QueryEditorToolbar\n        onRunQuery={props.onRunQuery}\n        onToggleEditorMode={onToggleEditorMode}\n        editorMode={editorMode}\n        onChangeDatabase={onChangeDatabase}\n        database={database}\n        databases={databases}\n        dirty={dirty}\n      />\n      {editorMode === 'raw' && (\n        <RawQueryEditor\n          {...props}\n          schema={schema.value}\n          templateVariableOptions={templateVariables}\n          lastQuery={executedQuery}\n          database={database}\n        />\n      )}\n      {editorMode === 'visual' && (\n        <VisualQueryEditor\n          datasource={datasource}\n          database={database}\n          onChangeQuery={props.onChange}\n          query={query}\n          schema={schema.value}\n          templateVariableOptions={templateVariables}\n        />\n      )}\n    </>\n  );\n};\n\nconst useSelectedDatabase = (options: QueryEditorPropertyDefinition[], query: KustoQuery): string => {\n  return useMemo(() => {\n    const selected = options.find(option => option.value === query.database);\n\n    if (selected) {\n      return selected.value;\n    }\n\n    if (options.length > 0) {\n      return options[0].value;\n    }\n\n    return '';\n  }, [options, query.database]);\n};\n\nconst useDatabaseOptions = (schema?: AdxSchema): QueryEditorPropertyDefinition[] => {\n  return useMemo(() => {\n    const databases: QueryEditorPropertyDefinition[] = [];\n\n    if (!schema || !schema.Databases) {\n      return databases;\n    }\n\n    for (const name of Object.keys(schema.Databases)) {\n      const database = schema.Databases[name];\n      databases.push(databaseToDefinition(database));\n    }\n\n    return databases;\n  }, [schema]);\n};\n\nconst useExecutedQuery = (data?: PanelData): string => {\n  return useMemo(() => {\n    return data?.series[0]?.meta?.executedQueryString ?? '';\n  }, [data]);\n};\n\nconst useDirty = (query: string, executedQuery: string): boolean => {\n  return useMemo(() => {\n    // we need to interpolate/deinterpolate it so we compare same things.\n    return query !== executedQuery;\n  }, [query, executedQuery]);\n};\n\nconst useExecutedQueryError = (data?: PanelData): string | undefined => {\n  return useMemo(() => {\n    const kustoError = data?.series[0]?.meta?.custom?.KustoError;\n\n    if (data?.error && !kustoError) {\n      if (data.error.message) {\n        return `${data.error.message}`;\n      }\n      return `${data.error}`;\n    }\n\n    return kustoError;\n  }, [data]);\n};\n\nconst useTemplateVariables = (datasource: AdxDataSource) => {\n  return useMemo(() => {\n    return {\n      label: 'Template Variables',\n      expanded: false,\n      options: datasource.variables.map(variable => {\n        return { label: variable, value: variable };\n      }),\n    };\n  }, [datasource.id]);\n};\n\n// export class QueryEditor extends PureComponent<Props, State> {\n//   private schemaResolver: AdxSchemaResolver;\n//   private kustoExpressionParser: KustoExpressionParser;\n\n//   constructor(props: Props) {\n//     super(props);\n\n//     this.schemaResolver = new AdxSchemaResolver(this.props.datasource);\n//     this.kustoExpressionParser = new KustoExpressionParser();\n//   }\n\n//   state: State = {\n//     dirty: false,\n//     columns: [],\n//     databases: [],\n//     tables: [],\n//     loadingColumnSchema: false,\n//   };\n\n//   templateVariableOptions: any;\n\n//   // Check when the query has changed, but not yet run\n//   componentDidUpdate(oldProps: Props) {\n//     const { data } = this.props;\n//     if (oldProps.data !== data) {\n//       const payload: State = {\n//         lastQueryError: '',\n//         lastQuery: '',\n//         dirty: false,\n//         columns: this.state.columns,\n//         tables: this.state.tables,\n//         databases: this.state.databases,\n//         loadingColumnSchema: false,\n//       };\n//       if (data) {\n//         if (data.series && data.series.length) {\n//           const fristSeriesMeta = data.series[0].meta;\n//           if (fristSeriesMeta) {\n//             payload.lastQuery = fristSeriesMeta.executedQueryString;\n//             payload.timeNotASC = fristSeriesMeta.custom?.TimeNotASC;\n\n//             payload.lastQueryError = fristSeriesMeta.custom?.KustoError;\n//           }\n//         }\n\n//         if (data.error && !payload.lastQueryError) {\n//           if (data.error.message) {\n//             payload.lastQueryError = `${data.error.message}`;\n//           } else {\n//             payload.lastQueryError = `${data.error}`;\n//           }\n//         }\n//       }\n\n//       this.setState(payload);\n//     }\n//   }\n\n//   async componentDidMount() {\n//     try {\n//       let query = { ...this.props.query }; // mutable query\n//       const databaseSchema = await this.schemaResolver.getDatabases();\n//       const databases = databasesToDefinition(databaseSchema);\n\n//       // Default first database...\n//       if (!query.database && databases.length) {\n//         if (databases[0] && databases[0].value) {\n//           query.database = databases[0].value;\n//         }\n//       }\n\n//       const tableSchema = await this.schemaResolver.getTablesForDatabase(query.database);\n//       const table = this.kustoExpressionParser.fromTable(this.props.query.expression?.from);\n//       let columnSchema = this.state.columns;\n\n//       if (table) {\n//         columnSchema = await this.schemaResolver.getColumnsForTable(query.database, table);\n//       }\n\n//       // Set the raw mode\n//       if (isInitialRawMode(this.props) && !query.rawMode) {\n//         query.rawMode = true;\n//       }\n//       if (!query.resultFormat) {\n//         query.resultFormat = 'time_series';\n//       }\n\n//       this.onUpdateQuery(query);\n\n//       this.templateVariableOptions = {\n//         label: 'Template Variables',\n//         expanded: false,\n//         options: this.props.datasource.variables?.map(toOption) || [],\n//       };\n\n//       this.setState({\n//         tables: tableSchema,\n//         databases: databaseSchema,\n//         columns: columnSchema,\n//         schema: true,\n//       });\n\n//       // Update the latest error etc\n//       this.componentDidUpdate({} as Props);\n//     } catch (error) {\n//       console.log('error', error);\n//     }\n//   }\n\n//   onUpdateQuery = (q: KustoQuery, run?: boolean) => {\n//     // Render the query when the expression changes\n//     if (q.expression !== this.props.query.expression) {\n//       const expression = q.expression || defaultQuery;\n\n//       const { database } = this.props.query;\n//       const { columns } = this.state;\n\n//       q = {\n//         ...q,\n//         query: this.kustoExpressionParser.query(expression, columns, database),\n//       };\n//     }\n\n//     this.props.onChange(q);\n//     console.log('onChange', q);\n//     if (run) {\n//       this.props.onRunQuery();\n//       console.log('onRunQuery', q);\n//     } else {\n//       this.setState({ dirty: true });\n//     }\n//   };\n\n//   onToggleRawMode = () => {\n//     const { query } = this.props;\n//     this.props.onChange({\n//       ...query,\n//       rawMode: !query.rawMode,\n//     });\n//   };\n\n//   onRawQueryChange = (kql: string) => {\n//     this.onUpdateQuery({\n//       ...this.props.query,\n//       query: kql,\n//     });\n//   };\n\n//   onDatabaseChanged = (db: string) => {\n//     this.onUpdateQuery({\n//       ...this.props.query,\n//       database: db,\n//     });\n//   };\n\n//   onFromChanged = async (from: QueryEditorExpression) => {\n//     const { query } = this.props;\n\n//     this.onUpdateQuery(\n//       this.verifyGroupByTime({\n//         ...query,\n//         expression: {\n//           ...defaultQuery,\n//           ...query.expression,\n//           from,\n//           where: defaultQuery.where,\n//           groupBy: defaultQuery.groupBy,\n//           reduce: defaultQuery.reduce,\n//         },\n//       })\n//     );\n\n//     this.setState({ ...this.state, loadingColumnSchema: true });\n//     const table = this.kustoExpressionParser.fromTable(from);\n//     const columns = await this.schemaResolver.getColumnsForTable(query.database, table);\n//     this.setState({ ...this.state, columns, loadingColumnSchema: false });\n//   };\n\n//   onWhereChanged = (where: QueryEditorArrayExpression) => {\n//     const { query } = this.props;\n//     this.onUpdateQuery({\n//       ...query,\n//       expression: {\n//         ...defaultQuery,\n//         ...query.expression,\n//         where,\n//       },\n//     });\n//   };\n\n//   onReduceChanged = (reduce: QueryEditorArrayExpression) => {\n//     const { query } = this.props;\n//     this.onUpdateQuery({\n//       ...query,\n//       expression: {\n//         ...defaultQuery,\n//         ...query.expression,\n//         reduce,\n//       },\n//     });\n//   };\n\n//   onGroupByChanged = (groupBy: QueryEditorArrayExpression) => {\n//     const { query } = this.props;\n//     this.onUpdateQuery({\n//       ...query,\n//       expression: {\n//         ...defaultQuery,\n//         ...query.expression,\n//         groupBy,\n//       },\n//     });\n//   };\n\n//   onResultFormatChanged = (v: SelectableValue<string>) => {\n//     this.onUpdateQuery(\n//       this.verifyGroupByTime({\n//         ...this.props.query,\n//         resultFormat: v.value || 'time_series',\n//       }),\n//       false\n//     );\n//   };\n\n//   onAliasChanged = (v: any) => {\n//     const { query } = this.props;\n//     this.onUpdateQuery(\n//       {\n//         ...query,\n//         alias: v.currentTarget.value,\n//       },\n//       false\n//     );\n//   };\n\n//   verifyGroupByTime(query: KustoQuery): KustoQuery {\n//     if (!query || query.resultFormat !== 'time_series' || query.rawMode) {\n//       return query;\n//     }\n//     let table = (query.expression?.from as any)?.value;\n//     if (table && !(query?.expression?.groupBy as any)?.expressions?.length) {\n//       table = this.kustoExpressionParser.fromTable(query.expression?.from, true);\n//       const definitions = columnsToDefinition(this.state.columns);\n//       const timeField = definitions?.find(c => c.type === QueryEditorPropertyType.DateTime);\n//       if (timeField) {\n//         let reduce = query.expression?.reduce;\n//         if (!reduce) {\n//           // Needed so that the summarize renders\n//           reduce = {\n//             type: QueryEditorExpressionType.And,\n//             expressions: [],\n//           } as QueryEditorArrayExpression;\n//         }\n\n//         const groupBy: QueryEditorArrayExpression = {\n//           type: QueryEditorExpressionType.And,\n//           expressions: [\n//             {\n//               type: QueryEditorExpressionType.GroupBy,\n//               property: {\n//                 type: QueryEditorPropertyType.DateTime,\n//                 name: timeField.value,\n//               },\n//               interval: {\n//                 type: QueryEditorPropertyType.Interval,\n//                 name: '$__interval',\n//               },\n//             } as QueryEditorGroupByExpression,\n//           ],\n//         };\n\n//         return {\n//           ...query,\n//           expression: {\n//             ...query.expression!,\n//             reduce,\n//             groupBy,\n//           },\n//         };\n//       }\n//     }\n//     return query;\n//   }\n\n//   // The debounced version is passed down as properties\n//   getSuggestions = async (txt: string, skip?: QueryEditorProperty): Promise<Array<SelectableValue<string>>> => {\n//     const { query } = this.props;\n\n//     // For now just support finding distinct field values\n//     const from = this.kustoExpressionParser.fromTable(query.expression?.from);\n//     const field = skip?.name;\n\n//     if (!from || !field) {\n//       return Promise.resolve([]);\n//     }\n\n//     // Covid19\n//     // | distinct State | order by State  asc | take 5\n//     // Covid19 |\n//     //  where  $__timeFilter(Timestamp) | distinct State | order by State asc | take 5\n\n//     let kql = `${from}\\n`;\n//     if (txt) {\n//       kql += `| where ${field} contains \"${txt}\" `;\n//     }\n//     kql += `| distinct ${field} | order by ${field} asc | take 251`;\n\n//     const q: KustoQuery = {\n//       ...query,\n//       rawMode: true,\n//       query: kql,\n//       resultFormat: 'table',\n//     };\n\n//     console.log('Get suggestions', kql);\n\n//     return this.props.datasource\n//       .query({\n//         targets: [q],\n//       } as DataQueryRequest<KustoQuery>)\n//       .toPromise()\n//       .then(res => {\n//         if (res.data?.length) {\n//           return res.data[0].fields[0].values.toArray().map(value => {\n//             return {\n//               label: `${value}`,\n//               value,\n//             };\n//           });\n//         }\n//         console.log('Got response', kql, res);\n//         return [];\n//       });\n//   };\n\n//   getSuggestionsNicely = debounce(this.getSuggestions, 300, {\n//     leading: false,\n//   });\n\n//   render() {\n//     const { query } = this.props;\n//     const { schema, lastQueryError, lastQuery, dirty } = this.state;\n\n//     if (!schema) {\n//       return <>Loading schema...</>;\n//     }\n\n//     const { database, expression, alias, resultFormat } = query;\n//     const databases = databasesToDefinition(this.state.databases);\n\n//     // Proces the raw mode\n//     if (query.rawMode) {\n//       return (\n//         <RawQueryEditor\n//           {...this.props}\n//           {...this.state}\n//           onRawModeChange={this.onToggleRawMode}\n//           templateVariableOptions={this.templateVariableOptions}\n//           onAliasChanged={this.onAliasChanged}\n//           onResultFormatChanged={this.onResultFormatChanged}\n//           onDatabaseChanged={this.onDatabaseChanged}\n//           onRawQueryChange={this.onRawQueryChange}\n//           databases={databases}\n//         />\n//       );\n//     }\n\n//     const { from, where, reduce, groupBy } = expression || defaultQuery;\n//     const tables = tablesToDefinition(this.state.tables);\n//     const columns = columnsToDefinition(this.state.columns);\n\n//     if (this.state.loadingColumnSchema) {\n//       return (\n//         <>\n//           <DatabaseSelect\n//             labelWidth={12}\n//             databases={databases!}\n//             templateVariableOptions={this.templateVariableOptions}\n//             database={database}\n//             onChange={this.onDatabaseChanged}\n//           >\n//             <>\n//               <div className=\"gf-form gf-form--grow\">\n//                 <div className=\"gf-form-label--grow\" />\n//               </div>\n//               <Button onClick={this.onToggleRawMode}>Edit KQL</Button>&nbsp;\n//               <Button\n//                 variant={dirty ? 'primary' : 'secondary'}\n//                 onClick={() => {\n//                   this.props.onRunQuery();\n//                 }}\n//               >\n//                 Run Query\n//               </Button>\n//             </>\n//           </DatabaseSelect>\n//           <KustoFromEditorSection\n//             value={from}\n//             label=\"From\"\n//             fields={tables!}\n//             templateVariableOptions={this.templateVariableOptions}\n//             onChange={this.onFromChanged}\n//           />\n//           <span>loading columns schema</span>\n\n//           <TextArea cols={80} rows={8} value={dirty ? query.query : lastQuery} disabled={true} />\n\n//           {lastQueryError && (\n//             <div className=\"gf-form\">\n//               <pre className=\"gf-form-pre alert alert-error\">{lastQueryError}</pre>\n//             </div>\n//           )}\n//         </>\n//       );\n//     }\n\n//     const groupable =\n//       columns?.filter(\n//         column => column.type === QueryEditorPropertyType.DateTime || column.type === QueryEditorPropertyType.String\n//       ) ?? [];\n\n//     const styles = getStyles();\n\n//     return (\n//       <>\n//         <DatabaseSelect\n//           labelWidth={12}\n//           databases={databases!}\n//           templateVariableOptions={this.templateVariableOptions}\n//           database={database}\n//           onChange={this.onDatabaseChanged}\n//         >\n//           <>\n//             <div className=\"gf-form gf-form--grow\">\n//               <div className=\"gf-form-label--grow\" />\n//             </div>\n//             <Button onClick={this.onToggleRawMode}>Edit KQL</Button>&nbsp;\n//             <Button\n//               variant={dirty ? 'primary' : 'secondary'}\n//               onClick={() => {\n//                 this.props.onRunQuery();\n//               }}\n//             >\n//               Run Query\n//             </Button>\n//           </>\n//         </DatabaseSelect>\n//         <KustoFromEditorSection\n//           value={from}\n//           label=\"From\"\n//           fields={tables!}\n//           templateVariableOptions={this.templateVariableOptions}\n//           onChange={this.onFromChanged}\n//         />\n//         <KustoWhereEditorSection\n//           value={where ?? defaultQuery.where}\n//           label=\"Where (filter)\"\n//           fields={columns}\n//           templateVariableOptions={this.templateVariableOptions}\n//           onChange={this.onWhereChanged}\n//           getSuggestions={this.getSuggestionsNicely}\n//         />\n//         <KustoValueColumnEditorSection\n//           value={reduce ?? defaultQuery.reduce}\n//           label=\"Value columns\"\n//           fields={columns}\n//           templateVariableOptions={this.templateVariableOptions}\n//           onChange={this.onReduceChanged}\n//           getSuggestions={this.getSuggestionsNicely}\n//         />\n//         <KustoGroupByEditorSection\n//           value={groupBy ?? defaultQuery.groupBy}\n//           label=\"Group by (summarize)\"\n//           fields={groupable}\n//           templateVariableOptions={this.templateVariableOptions}\n//           onChange={this.onGroupByChanged}\n//           getSuggestions={this.getSuggestionsNicely}\n//         />\n\n//         <div className={styles.buttonRow}>\n//           <HorizontalGroup>\n//             <div className=\"gf-form\">\n//               <InlineFormLabel className=\"query-keyword\" width={12}>\n//                 Format as\n//               </InlineFormLabel>\n//               <Select options={resultFormats} value={resultFormat} onChange={this.onResultFormatChanged} />\n//             </div>\n//             {false && resultFormat === 'time_series' && (\n//               <>\n//                 <InlineFormLabel className=\"query-keyword\" width={7}>\n//                   Alias by\n//                 </InlineFormLabel>\n//                 <Input\n//                   width={30}\n//                   type=\"text\"\n//                   value={alias}\n//                   placeholder=\"Naming pattern\"\n//                   onChange={this.onAliasChanged}\n//                   onBlur={() => {\n//                     this.props.onRunQuery();\n//                   }}\n//                 />\n//               </>\n//             )}\n//           </HorizontalGroup>\n//         </div>\n\n//         <TextArea cols={80} rows={8} value={dirty ? query.query : lastQuery} disabled={true} />\n\n//         {lastQueryError && (\n//           <div className=\"gf-form\">\n//             <pre className=\"gf-form-pre alert alert-error\">{lastQueryError}</pre>\n//           </div>\n//         )}\n//       </>\n//     );\n//   }\n// }\n\n// const resultFormats: Array<SelectableValue<string>> = [\n//   { label: 'Time series', value: 'time_series' },\n//   { label: 'Table', value: 'table' },\n// ];\n\n// const getStyles = stylesFactory(() => ({\n//   buttonRow: css`\n//     padding: 10px 0px;\n//   `,\n// }));\n\n// const toOption = (value: string) => ({ label: value, value } as SelectableValue<string>);\n\nfunction isRawMode(props: Props): boolean {\n  if (props.query.rawMode === undefined && props.query.query && !props.query.expression?.from) {\n    return true;\n  }\n  return props.query.rawMode || false;\n}\n","import { isNumber } from 'lodash';\n\nconst versionPattern = /^(\\d+)(?:\\.(\\d+))?(?:\\.(\\d+))?(?:-([0-9A-Za-z\\.]+))?/;\n\nexport class SemVersion {\n  major: number;\n  minor: number;\n  patch: number;\n  meta: string;\n\n  constructor(version: string) {\n    this.major = 0;\n    this.minor = 0;\n    this.patch = 0;\n    this.meta = '';\n\n    const match = versionPattern.exec(version);\n    if (match) {\n      this.major = Number(match[1]);\n      this.minor = Number(match[2] || 0);\n      this.patch = Number(match[3] || 0);\n      this.meta = match[4];\n    }\n  }\n\n  isGtOrEq(version: string): boolean {\n    const compared = new SemVersion(version);\n\n    for (let i = 0; i < this.comparable.length; ++i) {\n      if (this.comparable[i] > compared.comparable[i]) {\n        return true;\n      }\n      if (this.comparable[i] < compared.comparable[i]) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  isValid(): boolean {\n    return isNumber(this.major);\n  }\n\n  get comparable() {\n    return [this.major, this.minor, this.patch];\n  }\n}\n\nexport function isVersionGtOrEq(a: string, b: string): boolean {\n  const aSemver = new SemVersion(a);\n  return aSemver.isGtOrEq(b);\n}\n","import { AdxDataSource } from './datasource';\nimport config from 'grafana/app/core/config';\nimport { isVersionGtOrEq } from './version';\n\nexport class KustoDBConfigCtrl {\n  static templateUrl = 'partials/config.html';\n\n  current: any;\n  suggestUrl: string;\n  datasource: AdxDataSource | undefined;\n  databases: any[];\n  hasRequiredGrafanaVersion: boolean;\n  loading = false;\n\n  /** @ngInject */\n  constructor(private $scope) {\n    this.hasRequiredGrafanaVersion = this.hasMinVersion();\n    this.suggestUrl = 'https://yourcluster.kusto.windows.net';\n    $scope.getSuggestUrls = () => {\n      return [this.suggestUrl];\n    };\n\n    this.databases = [];\n    if (this.current.id) {\n      this.current.url = 'api/datasources/proxy/' + this.current.id;\n      this.datasource = new AdxDataSource(this.current);\n      this.getDatabases();\n    }\n  }\n\n  getDatabases() {\n    if (!this.datasource) {\n      return [];\n    }\n\n    this.loading = true;\n    return this.datasource.getDatabases().then(dbs => {\n      this.loading = false;\n      this.databases = dbs;\n      if (!this.current.jsonData.defaultDatabase && dbs.length) {\n        this.current.jsonData.defaultDatabase = dbs[0].value;\n      }\n      this.$scope.$digest(); // force thigns to re-render\n    });\n  }\n\n  hasMinVersion(): boolean {\n    return (\n      isVersionGtOrEq(config.buildInfo.latestVersion, '5.3') ||\n      config.buildInfo.version === '5.3.0-beta1' ||\n      config.buildInfo.version === '5.3.0-pre1'\n    );\n  }\n\n  showMinVersionWarning() {\n    return !this.hasRequiredGrafanaVersion;\n  }\n}\n","/* eslint-disable */\n/* tslint:disable */\n///<reference path=\"../../node_modules/monaco-editor/monaco.d.ts\" />\n/* tslint:enable */\n/* eslint-enable */\n\nimport angular from 'angular';\nimport KustoCodeEditor from './kusto_code_editor';\nimport config from 'grafana/app/core/config';\n\nconst editorTemplate = `<div id=\"content\" tabindex=\"0\" style=\"width: 100%; height: 150px\"></div>`;\n\nfunction link(scope, elem, attrs) {\n  const containerDiv = elem.find('#content')[0];\n\n  if (!window.hasOwnProperty('monaco')) {\n    //(window as any).monaco = import(/* webpackChunkName: \"/monaco.min\" */ '../lib/monaco.min.js').then(() => {\n    (window as any).System.import(`/${scope.pluginBaseUrl}/libs/monaco.min.js`).then(() => {\n      setTimeout(() => {\n        initMonaco(containerDiv, scope);\n      }, 100);\n    });\n  } else {\n    setTimeout(() => {\n      initMonaco(containerDiv, scope);\n    }, 100);\n  }\n\n  containerDiv.onblur = () => {\n    scope.onChange();\n  };\n\n  containerDiv.onkeydown = evt => {\n    if (evt.key === 'Escape') {\n      evt.stopPropagation();\n      return true;\n    }\n\n    return undefined;\n  };\n\n  function initMonaco(containerDiv, scope) {\n    const kustoCodeEditor = new KustoCodeEditor(containerDiv, scope.defaultTimeField, scope.getSchema, config);\n    kustoCodeEditor.initMonaco(scope.content);\n\n    /* tslint:disable:no-bitwise */\n    kustoCodeEditor.addCommand(monaco.KeyMod.Shift | monaco.KeyCode.Enter, () => {\n      const newValue = kustoCodeEditor.getValue();\n      scope.content = newValue;\n      scope.onChange();\n    });\n    /* tslint:enable:no-bitwise */\n\n    // Sync with outer scope - update editor content if model has been changed from outside of directive.\n    scope.$watch('content', (newValue, oldValue) => {\n      const editorValue = kustoCodeEditor.getValue();\n      if (newValue !== editorValue && newValue !== oldValue) {\n        scope.$$postDigest(() => {\n          kustoCodeEditor.setEditorContent(newValue);\n        });\n      }\n    });\n\n    kustoCodeEditor.setOnDidChangeModelContent(() => {\n      scope.$apply(() => {\n        const newValue = kustoCodeEditor.getValue();\n        scope.content = newValue;\n      });\n    });\n\n    scope.$on('$destroy', () => {\n      kustoCodeEditor.disposeMonaco();\n    });\n\n    window.onresize = () => {\n      kustoCodeEditor.resize();\n    };\n  }\n}\n\n/** @ngInject */\nexport function kustoMonacoEditorDirective() {\n  return {\n    restrict: 'E',\n    template: editorTemplate,\n    scope: {\n      content: '=',\n      onChange: '&',\n      getSchema: '&',\n      defaultTimeField: '@',\n      pluginBaseUrl: '@',\n    },\n    link: link,\n  };\n}\n\nangular.module('grafana.controllers').directive('kustoMonacoEditor', kustoMonacoEditorDirective);\n","import './monaco/kusto_monaco_editor';\nexport class KustoDBAnnotationsQueryCtrl {\n  static templateUrl = 'partials/annotations.editor.html';\n  datasource: any;\n  annotation: any;\n  databases: any[];\n  showHelp = false;\n\n  defaultQuery =\n    '<your table>\\n| where $__timeFilter() \\n| project TimeGenerated, Text=YourTitleColumn, Tags=\"tag1,tag2\"';\n\n  /** @ngInject */\n  constructor() {\n    this.annotation.query = this.annotation.query || this.defaultQuery;\n    this.annotation.resultFormat = 'table';\n    this.databases = this.getDatabases();\n  }\n\n  getDatabases() {\n    if (this.databases && this.databases.length > 0) {\n      return this.databases;\n    }\n\n    return this.datasource\n      .getDatabases()\n      .then(list => {\n        this.databases = list;\n        if (list.length > 0 && !this.annotation.database) {\n          this.annotation.database = list[0].value;\n        }\n        return this.databases;\n      })\n      .catch(err => {});\n  }\n}\n","import { DataSourcePlugin } from '@grafana/data';\nimport { AdxDataSource } from './datasource';\nimport { QueryEditor } from './QueryEditor';\nimport { KustoDBConfigCtrl } from 'config_ctrl';\nimport { KustoDBAnnotationsQueryCtrl } from './annotations_query_ctrl';\nimport { AdxDataSourceOptions, KustoQuery } from './types';\n\nexport const plugin = new DataSourcePlugin<AdxDataSource, KustoQuery, AdxDataSourceOptions>(AdxDataSource)\n  .setConfigCtrl(KustoDBConfigCtrl)\n  .setAnnotationQueryCtrl(KustoDBAnnotationsQueryCtrl)\n  .setQueryEditor(QueryEditor);\n"],"sourceRoot":""}